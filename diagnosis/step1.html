<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>å°è±¡ã‚¢ãƒƒãƒ—è¨ºæ–­ - STEP1çµæœ</title>
  <link rel="stylesheet" href="../assets/styles/style.css">
  <link rel="stylesheet" href="../assets/styles/components.css">
  <style>
    .diag-container{max-width:900px;margin:36px auto;padding:20px}
    .diag-card{background:#fff;padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.06)}
    .muted{color:#6b7280}
    .result-article{background:linear-gradient(180deg,#ffffff 0%,#fbfcfe 100%);padding:22px;border-radius:14px;border:1px solid rgba(2,6,23,0.04);box-shadow:0 18px 60px rgba(2,6,23,0.06);transition:transform .36s ease}
    .result-article:hover{transform:translateY(-4px)}
    .result-header{display:flex;align-items:center;gap:8px}
    .badge-emoji{display:inline-block;width:44px;height:44px;border-radius:999px;background:linear-gradient(135deg,#fff 0%,#fffbeb 100%);box-shadow:0 6px 18px rgba(2,6,23,0.08);display:flex;align-items:center;justify-content:center;font-size:20px;margin-right:10px}
    .result-actions{display:flex;gap:8px;margin-top:12px}
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:#111;color:#fff;text-decoration:none}
    .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:#111}
  </style>
  </head>
<body>
  <header id="site-header"></header>
  <main>
    <div class="diag-container">
      <div class="diag-card">
        <h1>STEP1 ã®çµæœ</h1>
        <p class="muted">ç¬¬1æ®µéšï¼ˆ3å•ï¼‰ã®é¸æŠã«åŸºã¥ãã€Œãªã‚ŠãŸã„å°è±¡ï¼ˆWHATï¼‰ã€ã®çµæœã§ã™ã€‚å¿…è¦ãªã‚‰ã€ã“ã®æ™‚ç‚¹ã§è¦‹ç›´ã—ã‚‚ã§ãã¾ã™ã€‚</p>
        <div id="result-root"><div id="loading">çµæœã‚’èª­ã¿è¾¼ã¿ä¸­â€¦</div></div>
      </div>
    </div>
  </main>
  <footer id="site-footer"></footer>
  <script src="../scripts/main.js" type="module"></script>
  <script>
  (function(){
    const STORAGE_KEY = 'fineme:diagnosis:latest';
    const INTENT_TYPES_URL = '/data/intent-types.json';
    const root = document.getElementById('result-root');
    const loading = document.getElementById('loading');

    const WHY_MAP = {
      r01:'è‡ªä¿¡ã‚’æŒã¡ãŸã„',
      r02:'å‘¨ã‚Šã‹ã‚‰ã®è¦‹ã‚‰ã‚Œæ–¹ã‚’å¤‰ãˆãŸã„',
      r03:'ä»Šã®è‡ªåˆ†ã‚’å°‘ã—å¥½ãã«ãªã‚ŠãŸã„',
      r04:'ä½•ã‚’ã™ã‚Œã°è‰¯ã„ã‹åˆ†ã‹ã‚‰ãªã„',
      r05:'ç‰¹åˆ¥ãªãã£ã‹ã‘ãŒã‚ã£ãŸ'
    };

    function renderNotFound(){
      const wrap = document.createElement('div');
      const msg = document.createElement('p'); msg.textContent = 'STEP1ã®çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚';
      const a = document.createElement('a'); a.href = '/diagnosis/index.html'; a.className = 'btn'; a.textContent = 'è¨ºæ–­ã‚’ã‚„ã‚Šç›´ã™';
      wrap.appendChild(msg); wrap.appendChild(a);
      root.innerHTML = ''; root.appendChild(wrap);
    }

    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw){ renderNotFound(); return; }
      const obj = JSON.parse(raw);
      const intentId = obj?.intent?.type_id || '';
      const intentName = obj?.intent?.type_name || '';
      const whyId = obj?.why?.reason_id || '';
      const howName = obj?.how?.style_name || '';

      fetch(INTENT_TYPES_URL).then(r=>r.json()).then(typesData=>{
        const entry = typesData[intentId] || { name:intentName||'æœªé¸æŠ', catch:'', description:'', advice:'', image:'' };
        root.innerHTML = '';

        const article = document.createElement('article'); article.className='result-article'; article.style.lineHeight='1.7';

        // ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šSTEP1çµæœ
        const headerWrap = document.createElement('div'); headerWrap.className = 'result-header';
        const badge = document.createElement('div'); badge.className='badge-emoji'; badge.textContent='ğŸ”'; headerWrap.appendChild(badge);
        const title = document.createElement('h2'); title.style.fontSize='22px'; title.style.margin='0'; title.textContent = `ç¬¬1æ®µéšã®çµæœï¼šã€Œ${entry.name}ã€`;
        headerWrap.appendChild(title);
        article.appendChild(headerWrap);

        if(entry.catch){ const catchEl = document.createElement('p'); catchEl.style.margin='8px 0 12px 0'; catchEl.style.fontWeight='600'; catchEl.textContent = entry.catch; article.appendChild(catchEl); }
        if(entry.description){ const p = document.createElement('p'); p.textContent = entry.description; article.appendChild(p); }
        if(entry.advice){ const advh = document.createElement('h3'); advh.textContent='ã“ã®å°è±¡ã«è¿‘ã¥ãã‚³ãƒ„'; article.appendChild(advh); const advp = document.createElement('p'); advp.textContent = entry.advice; article.appendChild(advp); }

        // ã‚ãªãŸã®é¸æŠï¼ˆWHY/HOWã®è¦ç´„ï¼‰
        const selh = document.createElement('h3'); selh.textContent='ã‚ãªãŸã®é¸æŠï¼ˆSTEP1ï¼‰'; article.appendChild(selh);
        const ul = document.createElement('ul');
        const li1 = document.createElement('li'); li1.textContent = `å‹•æ©Ÿï¼ˆWHYï¼‰ï¼š${WHY_MAP[whyId] || 'â€”'}`; ul.appendChild(li1);
        const li2 = document.createElement('li'); li2.textContent = `é–¢ã‚ã‚Šæ–¹ï¼ˆHOWï¼‰ï¼š${howName || 'â€”'}`; ul.appendChild(li2);
        article.appendChild(ul);

        const actions = document.createElement('div'); actions.className='result-actions';
        const goStep2 = document.createElement('a'); goStep2.href='/diagnosis/step2.html'; goStep2.className='btn'; goStep2.textContent='ç²¾åº¦ã‚’ä¸Šã’ã‚‹ï¼ˆSTEP2ã¸ï¼‰';
        const retry = document.createElement('a'); retry.href='/diagnosis/index.html'; retry.className='btn btn-ghost'; retry.textContent='STEP1ã‚’ã‚„ã‚Šç›´ã™';
        actions.appendChild(goStep2); actions.appendChild(retry);
        article.appendChild(actions);

        root.appendChild(article);
      }).catch(()=>{ loading.textContent='ã‚¿ã‚¤ãƒ—ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'; });
    }catch(e){ renderNotFound(); }
  })();
  </script>
</body>
</html>
