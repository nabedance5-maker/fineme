<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>å°è±¡ã‚¢ãƒƒãƒ—è¨ºæ–­ - çµæœ</title>
  <link rel="stylesheet" href="../assets/styles/style.css">
  <link rel="stylesheet" href="../assets/styles/components.css">
  <style>
    .diag-container{max-width:900px;margin:36px auto;padding:20px}
    .diag-card{background:#fff;padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.06)}
    .result-title{font-size:22px;font-weight:800}
    .muted{color:#6b7280}
  .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:#111;color:#fff;text-decoration:none}
  /* result article styling */
  .result-article{background:linear-gradient(180deg,#ffffff 0%,#fbfcfe 100%);padding:22px;border-radius:14px;border:1px solid rgba(2,6,23,0.04);box-shadow:0 18px 60px rgba(2,6,23,0.06);transition:transform .36s ease}
  .result-article:hover{transform:translateY(-6px)}
  .type-hero{display:block;margin:12px auto 18px auto;max-width:520px;width:100%;border-radius:12px;box-shadow:0 18px 40px rgba(2,6,23,0.14);object-fit:cover}
  .result-article h2{font-size:24px;margin-bottom:6px}
  .result-article h3{margin-top:14px;margin-bottom:6px}
  .result-label{color:#374151;margin-top:6px;font-size:14px}
  .badge-emoji{display:inline-block;width:44px;height:44px;border-radius:999px;background:linear-gradient(135deg,#fff 0%,#fffbeb 100%);box-shadow:0 6px 18px rgba(2,6,23,0.08);display:flex;align-items:center;justify-content:center;font-size:20px;margin-right:10px}
  .result-header{display:flex;align-items:center;gap:8px}
  .result-actions{display:flex;gap:8px;margin-top:12px}
  .result-actions{display:flex;gap:8px;margin-top:16px;flex-wrap:wrap}
  .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:#111}
  .toast{position:fixed;right:20px;bottom:20px;background:#111;color:#fff;padding:8px 12px;border-radius:8px;opacity:0;transform:translateY(8px);transition:opacity .25s,transform .25s}
  .toast.show{opacity:1;transform:translateY(0)}
  @keyframes floatUp { from { transform: translateY(8px); opacity:0 } to { transform: translateY(0); opacity:1 } }
  /* block cards */
  .blocks-grid{display:grid;grid-template-columns:1fr;gap:12px;margin:8px 0 16px}
  .block{background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px;padding:12px}
  .block-title{font-weight:700;margin-bottom:6px}
  .space-y{margin-top:16px}

  /* highlight chips */
  .highlights{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 12px}
  .chip{background:#fff;border:1px solid #e5e7eb;border-radius:999px;padding:4px 10px;font-size:12px}

  /* horizontal slider */
  .result-slider{position:relative;margin-top:8px}
  .slider-controls{position:absolute;right:8px;top:-32px;display:flex;gap:8px}
  .slider-track{display:flex;gap:12px;overflow-x:auto;scroll-snap-type:x mandatory;padding-bottom:8px;-webkit-overflow-scrolling:touch}
  .slider-track::-webkit-scrollbar{height:8px}
  .slider-track::-webkit-scrollbar-thumb{background:#e5e7eb;border-radius:8px}
  .slide-card{flex:0 0 auto;width:200px;scroll-snap-align:start;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 4px 12px rgba(2,6,23,0.06);text-decoration:none;color:#111827}
  .slide-card:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(2,6,23,0.08);transition:all .2s ease}
  .slide-image-wrap{display:flex;align-items:center;justify-content:center;height:120px;background:#f3f4f6;border-bottom:1px solid #e5e7eb;border-top-left-radius:12px;border-top-right-radius:12px}
  .slide-image-wrap img{max-width:72px;height:auto}
  .slide-label{padding:10px;font-weight:600}
  /* slide emoji badge */
  .slide-emoji{display:inline-flex;align-items:center;justify-content:center;width:44px;height:44px;border-radius:999px;background:linear-gradient(135deg,#fff 0%,#fef3c7 100%);box-shadow:0 6px 18px rgba(2,6,23,0.08);font-size:20px;margin:10px}
  /* info button & popover */
  .info-btn{background:transparent;border:1px solid #e5e7eb;color:#111;padding:6px 8px;border-radius:8px}
  .popover{position:absolute;right:8px;top:8px;z-index:30;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 12px 32px rgba(2,6,23,0.12);padding:12px;max-width:320px;display:none}
  .popover.show{display:block}
  .popover-title{font-weight:700;margin-bottom:6px}
  .popover p{color:#374151;font-size:14px;margin:6px 0}

  /* å¼·åˆ¶ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆï¼ˆã“ã®ãƒšãƒ¼ã‚¸å†…é™å®šï¼‰ */
  .result-article .btn{ background:#111 !important; color:#fff !important; border:none !important; box-shadow:0 8px 18px rgba(2,6,23,0.18) }
  .result-article .btn-ghost{ background:transparent !important; color:#111 !important; border:1px solid #111 !important }
  .diag-card .btn{ background:#111 !important; color:#fff !important; border:none !important }
  </style>
</head>
<body>
  <header id="site-header"></header>

  <main>
    <div class="diag-container">
      <div class="diag-card">
        <h1>è¨ºæ–­çµæœ</h1>
        <div id="result-root">
          <div id="loading">çµæœã‚’èª­ã¿è¾¼ã¿ä¸­â€¦</div>
        </div>
  <p style="margin-top:12px;"><button id="retryBtn" class="btn">è¨ºæ–­ã‚’ã‚„ã‚Šç›´ã™</button></p>
      </div>
    </div>
  </main>
  <footer id="site-footer"></footer>
  <script src="../scripts/main.js" type="module"></script>
  <script>
    (function(){
      const STORAGE_KEY = 'fineme:diagnosis:latest';
      const INTENT_TYPES_URL = '../data/intent-types.json';
      const root = document.getElementById('result-root');
      const loading = document.getElementById('loading');
      const retryBtn = document.getElementById('retryBtn');
      // æ–°6ã‚¿ã‚¤ãƒ—ï¼ˆã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆè¡¨è¨˜ï¼‰
      const TYPE6_COPY = {
        t01: {
          name:'æ…é‡ãƒ»ç´å¾—é‡è¦–ã‚¿ã‚¤ãƒ—',
          state:'å¤‰ã‚ã‚ŠãŸã„æ°—æŒã¡ã¯ã‚ã‚‹ã®ã«ã€å¤±æ•—ã—ãŸããªã„æ€ã„ãŒå…ˆã«ç«‹ã¡ã€ä¸€æ­©ç›®ã‚’æ…é‡ã«é¸ã¼ã†ã¨ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚',
          strength:'è¡¨é¢çš„ãªå¤‰åŒ–ã§ã¯æº€è¶³ã›ãšã€ç†ç”±ã¨æ ¹æ‹ ã‚’å¤§åˆ‡ã«ã§ãã‚‹äººã§ã™ã€‚',
          fit:[
            'ç†ç”±ã‚’è¨€èªåŒ–ã—ã€ãƒ—ãƒ­ã‚»ã‚¹ãŒè¦‹ãˆã‚‹å°ã•ãªå¤‰åŒ–',
            'æŠ¼ã—å£²ã‚Šã›ãšã€è³ªå•ã«ä¸å¯§ã«ç­”ãˆã¦ãã‚Œã‚‹é–¢ã‚ã‚Šæ–¹',
            'è©¦ã—ã¦ã‹ã‚‰èª¿æ•´ã§ãã‚‹é€²ã‚æ–¹'
          ],
          empathy:'ã€Œãªã‚“ã¨ãªãã€ã§ã¯å‹•ã‹ãšã€ç†ç”±ã¨ç´å¾—ãŒæƒã£ãŸã¨ãã«æº€è¶³ã§ãã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚',
          logic:'èª¬æ˜ãŒä¸å¯§ã§ã€è€ƒãˆæ–¹ã‚„ãƒ—ãƒ­ã‚»ã‚¹ã‚’è¨€èªåŒ–ã§ãã‚‹åº—èˆ—ã¨ç›¸æ€§ãŒè‰¯ã„ã¨åˆ¤æ–­ã—ã¦ã„ã¾ã™ã€‚'
        },
        t02: {
          name:'å®‰å¿ƒãƒ»å¯„ã‚Šæ·»ã„é‡è¦–ã‚¿ã‚¤ãƒ—',
          state:'èˆˆå‘³ã¯ã‚ã‚‹ã‘ã‚Œã©ã€Œä½•ãŒæ­£è§£ã‹ã‚ã‹ã‚‰ãªã„ã€ä¸å®‰ãŒå¤§ããã€ä¼´èµ°ã‚„èª¬æ˜ãŒã‚ã‚‹ã¨é€²ã¿ã‚„ã™ã„çŠ¶æ…‹ã§ã™ã€‚',
          strength:'äººã®è©±ã‚’ç´ ç›´ã«èã‘ã¦ã€ç›¸è«‡ã—ãªãŒã‚‰æ±ºã‚ã‚‰ã‚Œã‚‹äººã§ã™ã€‚',
          fit:[
            'å…¨éƒ¨ä»»ã›ã‚‰ã‚Œã‚‹ç’°å¢ƒã§ã®å°ã•ãªå‰é€²',
            'æ‰‹é †ã‚’ä¸€ã¤ãšã¤ç¤ºã™é€²ã‚æ–¹',
            'ã“ã¾ã‚ãªç¢ºèªã¨å®‰å¿ƒã®æä¾›'
          ],
          empathy:'å¼·ã„å£²ã‚Šã‚ˆã‚Šã€å¯„ã‚Šæ·»ã„ã¨å®‰å¿ƒæ„ŸãŒã‚ã‚‹ã¨æº€è¶³ã—ã¾ã™ã€‚',
          logic:'ç„¡ç†ã‚’ã•ã›ãªã„é€²ã‚æ–¹ã§ã€ç›¸è«‡ã—ãªãŒã‚‰æ±ºã‚ã‚‰ã‚Œã‚‹åº—èˆ—ã‚’å„ªå…ˆã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚'
        },
        t03: {
          name:'åŠ¹ç‡ãƒ»æœ€çŸ­é‡è¦–ã‚¿ã‚¤ãƒ—',
          state:'ä»Šã®è‡ªåˆ†ã«é£½ãã‚„ç„¦ã‚ŠãŒã‚ã‚Šã€çµæœãŒè¦‹ãˆã‚‹ãªã‚‰ä¸€æ­©ã‚’æ—©ãè¸ã¿å‡ºã—ãŸã„çŠ¶æ…‹ã§ã™ã€‚',
          strength:'è¡Œå‹•åŠ›ãŒã‚ã‚Šã€è¦ç‚¹ã‚’æ´ã‚€ã®ãŒå¾—æ„ã§ã™ã€‚',
          fit:[
            'å®Ÿç¸¾ã¨çµæœãŒæ˜ç¢ºãªææ¡ˆ',
            'çŸ­ã„è©¦è¡Œã¨æ”¹å–„ã®ã‚µã‚¤ã‚¯ãƒ«',
            'ã‚´ãƒ¼ãƒ«ã¨è¨ˆç”»ãŒã¯ã£ãã‚Šã—ãŸé–¢ã‚ã‚Šæ–¹'
          ],
          empathy:'é å›ã‚ŠãŒè‹¦æ‰‹ã§ã€çµå±€ã©ã†ãªã‚‹ã‹ãŒæ˜ç¢ºã ã¨å®‰å¿ƒã§ãã¾ã™ã€‚',
          logic:'è¦ç‚¹ã‚’æŠ¼ã•ãˆã€å®Ÿç¸¾ã¨çµæœã‚’ç¤ºã›ã‚‹åº—èˆ—ã‚’ä¸Šä½ã«è¡¨ç¤ºã—ã¾ã™ã€‚'
        },
        t04: {
          name:'å¤‰åŒ–ãƒ»ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆé‡è¦–ã‚¿ã‚¤ãƒ—',
          state:'æ–°ã—ã„è‡ªåˆ†ã«ãƒ¯ã‚¯ãƒ¯ã‚¯ã—ã¦ãŠã‚Šã€æŒ‘æˆ¦ã‚’å‰å‘ãã«å—ã‘å…¥ã‚Œã‚‰ã‚Œã‚‹çŠ¶æ…‹ã§ã™ã€‚',
          strength:'å¤‰åŒ–ã‚’æ¥½ã—ã‚ã‚‹æŸ”è»Ÿã•ãŒã‚ã‚Šã¾ã™ã€‚',
          fit:[
            'ææ¡ˆåŠ›ãŒã‚ã‚ŠèƒŒä¸­ã‚’æŠ¼ã—ã¦ãã‚Œã‚‹é–¢ã‚ã‚Šæ–¹',
            'å®‰å…¨ç¶²ã‚’ç”¨æ„ã—ãŸç„¡ç†ã®ãªã„æŒ‘æˆ¦',
            'å¤‰åŒ–ã®æ„å›³ã‚’å…±æœ‰ã—ãªãŒã‚‰é€²ã‚ã‚‹'
          ],
          empathy:'å¤šå°‘ã®æŒ‘æˆ¦ã§ã‚‚ã€å¤‰ã‚ã‚Œã‚‹ãªã‚‰ä¸€æ­©ã‚’é¸ã¹ã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚',
          logic:'å¤‰åŒ–ã®ææ¡ˆåŠ›ãŒã‚ã‚Šã€èƒŒä¸­ã‚’æŠ¼ã—ã¦ãã‚Œã‚‹åº—èˆ—ã‚’å„ªå…ˆã—ã¾ã™ã€‚'
        },
        t05: {
          name:'ç›´æ„Ÿãƒ»ãƒ•ã‚£ãƒ¼ãƒªãƒ³ã‚°é‡è¦–ã‚¿ã‚¤ãƒ—',
          state:'é›°å›²æ°—ã‚„ä¸–ç•Œè¦³ã®åˆè‡´ãŒä½•ã‚ˆã‚Šå¤§äº‹ã§ã€è…‘ã«è½ã¡ã‚‹ç›¸æ‰‹ã¨ãªã‚‰è¸ã¿å‡ºã›ã‚‹çŠ¶æ…‹ã§ã™ã€‚',
          strength:'è‡ªåˆ†ã®æ„Ÿè¦šã‚’å¤§åˆ‡ã«ã—ã€ãã‚Œã‚’ç¶™ç¶šåŠ›ã«å¤‰ãˆã‚‰ã‚Œã‚‹äººã§ã™ã€‚',
          fit:[
            'ä¸–ç•Œè¦³ã¨ã‚¹ã‚¿ã‚¤ãƒ«ãŒæ˜ç¢ºãªç›¸æ‰‹',
            'äº‹ä¾‹ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ãã‚‹ææ¡ˆ',
            'ã¾ãšã¯å°ã•ãè©¦ã›ã‚‹ä¸€æ­©'
          ],
          empathy:'ä¸–ç•Œè¦³ã‚„ç©ºæ°—æ„Ÿã«ç´å¾—ã§ãã‚‹ã¨æº€è¶³ã™ã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚',
          logic:'ã‚¹ã‚¿ã‚¤ãƒ«ã‚„æ€æƒ³ãŒæ˜ç¢ºã§ã€æ„Ÿè¦šãŒåˆã†åº—èˆ—ã‚’å„ªå…ˆã—ã¾ã™ã€‚'
        },
        t06: {
          name:'ä¼´èµ°ãƒ»å…±åŒæ±ºå®šé‡è¦–ã‚¿ã‚¤ãƒ—',
          state:'ä¸€ç·’ã«è€ƒãˆãªãŒã‚‰ç´å¾—ã—ã¦é€²ã¿ãŸã„ã€ä¸»å°æ¨©ã‚’å…±æœ‰ã—ãŸã„çŠ¶æ…‹ã§ã™ã€‚',
          strength:'å¯¾è©±ã‚’é€šã˜ã¦æ„æ€æ±ºå®šã§ãã‚‹äººã§ã™ã€‚',
          fit:[
            'é¸æŠè‚¢ã‚’æç¤ºã—ã€å…±åŒã§æ±ºã‚ã‚‹é€²ã‚æ–¹',
            'æŒ¯ã‚Šè¿”ã‚Šã¨èª¿æ•´ã‚’å‰æã«ã—ãŸè¨­è¨ˆ',
            'ãƒ¡ãƒ¢ã‚„è¨˜éŒ²ã‚’å…±æœ‰ã—ãªãŒã‚‰é€²ã‚ã‚‹'
          ],
          empathy:'ä¸€ç·’ã«è€ƒãˆã€ç´å¾—ã—ãªãŒã‚‰é€²ã‚ãŸã„ã‚¿ã‚¤ãƒ—ã§ã™ã€‚',
          logic:'ææ¡ˆã¨å¯¾è©±ã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ãã€å…±åŒã§æ±ºã‚ã¦ã„ã‘ã‚‹åº—èˆ—ã‚’ä¸Šä½ã«è¡¨ç¤ºã—ã¾ã™ã€‚'
        }
      };

  function renderNotFound(){
    const wrap = document.createElement('div');
    const msg = document.createElement('p'); msg.textContent = 'è¨ºæ–­çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚';
    const a = document.createElement('a'); a.href = './index.html'; a.className = 'btn'; a.textContent = 'è¨ºæ–­ã‚’ã‚„ã‚Šç›´ã™';
    wrap.appendChild(msg); wrap.appendChild(a);
    root.innerHTML = ''; root.appendChild(wrap);
  }

      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw){ renderNotFound(); }
      else{
        try{
          const obj = JSON.parse(raw);
          const step2 = obj.step2 || {};
          const cls = step2.classification || { type_id:'t01', type_name:'æ…é‡ãƒ»ç´å¾—é‡è¦–ã‚¿ã‚¤ãƒ—' };
          const copy = TYPE6_COPY[cls.type_id] || TYPE6_COPY.t01;
          // typesDataï¼ˆæ—§ç¬¬2éšå±¤ï¼‰ã¯ä»»æ„ç”»åƒãªã©ã«ä½¿ã†ã€‚ãªãã¦ã‚‚é€²è¡Œã€‚
          fetch(INTENT_TYPES_URL).then(r=>r.json()).then(typesData=>{
            const entry = typesData[obj?.intent?.type_id || ''] || {};
            // æ–°MVPæ§‹æˆã§æç”»
            root.innerHTML = '';

            const article = document.createElement('article'); article.className = 'result-article'; article.style.marginTop = '12px'; article.style.lineHeight = '1.7';

            // â‘  ã‚¿ã‚¤ãƒˆãƒ«ï¼šä»Šã®ã‚ãªãŸã®çŠ¶æ…‹ï¼ˆåˆ¤å®šæ„Ÿã‚’é¿ã‘ã‚‹ï¼‰
            const headerWrap = document.createElement('div'); headerWrap.className = 'result-header';
            const badge = document.createElement('div'); badge.className = 'badge-emoji'; badge.textContent = 'ğŸ’«'; headerWrap.appendChild(badge);
            const titleWrap = document.createElement('div');
            const title = document.createElement('h2'); title.style.fontSize = '22px'; title.style.margin = '0';
            title.textContent = 'ä»Šã®ã‚ãªãŸã®çŠ¶æ…‹';
            titleWrap.appendChild(title);
            const label = document.createElement('div'); label.className='result-label';
            label.textContent = 'ã€Œç¾æ™‚ç‚¹ã§ã¯ã€ã“ã†è¦‹ãˆã¦ã„ã¾ã™ã€‚ç„¦ã‚‰ãªãã¦å¤§ä¸ˆå¤«ã€‚';
            titleWrap.appendChild(label);
            // æœ€æ–°ã®è¦‹ç«‹ã¦ï¼ˆSTEP2ï¼‰ã¨STEP1çµæœã®ä½µè¨˜
            try{
              const currentTypeName = String(cls?.type_name || '').trim();
              const initialTypeName = String(obj?.intent?.type_name || (typesData[obj?.intent?.type_id||'']?.name) || '').trim();
              if(currentTypeName || initialTypeName){
                const line = document.createElement('div');
                line.className = 'muted';
                line.style.fontSize = '13px';
                line.style.marginTop = '4px';
                if(currentTypeName && initialTypeName && currentTypeName !== initialTypeName){
                  line.textContent = `æœ€æ–°ã®è¦‹ç«‹ã¦ï¼š${currentTypeName}ï¼ˆSTEP1ã®çµæœï¼š${initialTypeName}ï¼‰`;
                } else {
                  const name = currentTypeName || initialTypeName;
                  line.textContent = `è¦‹ç«‹ã¦ï¼š${name}`;
                }
                titleWrap.appendChild(line);
                  // å‚è€ƒï¼šãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ©ãƒ™ãƒ«ï¼ˆè¡¨ç¤ºã®ã¿ï¼‰
                  if(currentTypeName && initialTypeName && currentTypeName !== initialTypeName){
                    const hybrid = document.createElement('div');
                    hybrid.className = 'muted';
                    hybrid.style.fontSize = '12px';
                    hybrid.style.marginTop = '2px';
                    hybrid.textContent = `ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¿ã‚¤ãƒ—ï¼š${initialTypeName} Ã— ${currentTypeName}`;
                    titleWrap.appendChild(hybrid);
                  }
              }
            }catch{}
            headerWrap.appendChild(titleWrap); article.appendChild(headerWrap);

            if(entry.image){ const heroWrap = document.createElement('div'); heroWrap.style.textAlign='center'; const hero = document.createElement('img'); hero.className = 'type-hero'; hero.src = entry.image; hero.alt = entry.name||''; hero.onerror = ()=>{ hero.style.display='none'; }; hero.style.animation='floatUp .6s ease both'; heroWrap.appendChild(hero); article.appendChild(heroWrap); }
            // å…±é€šã®ä½†ã—æ›¸ãï¼ˆä¸€èˆ¬æŒ‡é‡ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¤ºï¼‰
            const disclaimerTop = document.createElement('p'); disclaimerTop.className='muted'; disclaimerTop.textContent = 'ã“ã®ææ¡ˆã¯ä¸€èˆ¬çš„ãªæŒ‡é‡ã§ã™ã€‚é¡”ç«‹ã¡ãƒ»ä½“å‹ãƒ»ç›®çš„ã«ã‚ˆã£ã¦æœ€é©ã¯ç•°ãªã‚Šã¾ã™ã€‚å°ã•ãè©¦ã—ã¦ã€è¦³å¯Ÿâ†’èª¿æ•´ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚';
            article.appendChild(disclaimerTop);

            

            // â‘¡ çŠ¶æ…‹ã®è¨€èªåŒ–ï¼ˆã‚³ã‚¢ã‚³ãƒ”ãƒ¼ï¼‰
            const stateP = document.createElement('p'); stateP.style.margin='8px 0 12px 0'; stateP.textContent = copy.state || copy.empathy || '';
            article.appendChild(stateP);

            // â‘¡-1 ä¿¡é ¼åº¦ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼ˆã‚¿ã‚¤ãƒ—è·é›¢ã®ç°¡æ˜“å¯è¦–åŒ–ï¼‰
            (function(){
              try{
                const stored = JSON.parse(localStorage.getItem('fineme:diagnosis:latest')||'{}');
                const dist = Number(stored?.step2?.classification?.dist || 0);
                let level = 'ä¸­'; let desc = 'å›ç­”ã®æ•´åˆæ€§ã¯æ¨™æº–çš„ã§ã™';
                if(dist <= 2){ level = 'é«˜'; desc = 'å›ç­”ãŒä¸€è²«ã—ã¦ãŠã‚Šã€è¦‹ç«‹ã¦ã®ç¢ºåº¦ã¯é«˜ã‚ã§ã™'; }
                else if(dist >= 4){ level = 'ä½'; desc = 'è»¸ãŒæ‹®æŠ—ã—ã¦ã„ã¾ã™ã€‚å°‘ã—è¿½è³ªå•ã™ã‚‹ã¨ã•ã‚‰ã«ç¢ºåº¦ãŒä¸ŠãŒã‚Šã¾ã™'; }
                const block = document.createElement('div'); block.className='block';
                const title = document.createElement('div'); title.className='block-title'; title.textContent='ä¿¡é ¼åº¦'; block.appendChild(title);
                const p = document.createElement('p'); p.textContent = `ä¿¡é ¼åº¦ï¼š${level}ï¼ˆ${desc}ï¼‰`; block.appendChild(p);
                // ä½ä¿¡é ¼åº¦ã®ã¨ãã®ã¿ã€è¿½è³ªå•ã¸ã®å°ç·šãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                if(dist >= 4){
                  const btn = document.createElement('a');
                  btn.href = './step2.html?boost=1';
                  btn.className = 'btn';
                  btn.textContent = 'ç²¾åº¦ã‚’ä¸Šã’ã‚‹ï¼ˆ1ã€œ2å•ï¼‰';
                  try{ btn.style.setProperty('color','#fff','important'); }catch{}
                  const note = document.createElement('p'); note.className='muted'; note.textContent='â€» è¿½è³ªå•ã«ç­”ãˆã‚‹ã“ã¨ã§ã€ææ¡ˆã®ç²¾åº¦ãŒä¸ŠãŒã‚Šã¾ã™ã€‚';
                  block.appendChild(btn);
                  block.appendChild(note);
                }
                article.appendChild(block);
              }catch{}
            })();

            // â‘¡-2 è¦–ç‚¹ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆè€ƒãˆæ–¹/é¸ã³æ–¹/é€²ã‚æ–¹ï¼‰
            (function(){
              const axes = (obj?.step2?.scores?.axes) || {};
              const typeId = (obj?.step2?.classification?.type_id) || 't01';
              function mindsetTips(){
                const tips = [];
                if(Number(axes.motivation)>0) tips.push('å¤‰ã‚ã‚ŠãŸã„ç†ç”±ãŒæ˜ç¢ºã€‚ç›®çš„ã¨å†ç¾æ€§ã‚’é‡è¦–');
                if(Number(axes.support)>0) tips.push('ä¼´èµ°ã‚„ç¢ºèªã‚’é‡è¦–ã€‚ç´å¾—ã§ãã‚‹èª¬æ˜ãŒå®‰å¿ƒ');
                if(Number(axes.control)>0) tips.push('ä¸»å°æ¨©ã‚’æŒã£ã¦é€²ã‚ãŸã„ã€‚é€æ˜æ€§ã¨æ¯”è¼ƒã‚’é‡è¦–');
                if(Number(axes.change)>0) tips.push('å¤‰åŒ–ã®å®Ÿæ„Ÿã‚’æ—©ã‚ãŸã„ã€‚å°ã•ãªãƒ“ãƒ•ã‚©ãƒ¼/ã‚¢ãƒ•ã‚¿ãƒ¼ã§æ¤œè¨¼');
                if(!tips.length) tips.push('ä»Šã®è‡ªåˆ†ã«åˆã†é€²ã‚æ–¹ã‚’é¸ã¶ã“ã¨ã‚’é‡è¦–');
                return tips;
              }
              function labelWeight(lab){
                const ax = axes || {};
                const s = Number(ax.support)||0, c = Number(ax.change)||0, m = Number(ax.motivation)||0, ctrl = Number(ax.control)||0;
                const L = String(lab);
                if(/ç›¸è«‡|ãƒã‚§ãƒƒã‚¯|ä¼´èµ°/.test(L)) return s*2 + m;
                if(/å¯è¦–åŒ–|äº‹å‰èª¬æ˜|ç´å¾—|é€æ˜/.test(L)) return m*2 + ctrl;
                if(/æ¯”è¼ƒæ¤œè¨/.test(L)) return ctrl*2 + m;
                if(/çŸ­æœŸ|æˆæœæŒ‡æ¨™|æ—©ã„|ä»®èª¬æ¤œè¨¼/.test(L)) return c*2 + m;
                if(/å†™çœŸ/.test(L)) return c*1.5 + m;
                if(/æ›´æ–°ææ¡ˆ|ãƒãƒ£ãƒ¬ãƒ³ã‚¸|å°ã•ãè©¦/.test(L)) return c*2 + s;
                if(/æŸ”è»Ÿ|èª¿æ•´/.test(L)) return s*2 + ctrl;
                if(/ä¸–ç•Œè¦³|é›°å›²æ°—/.test(L)) return 0.5;
                if(/ç¿’æ…£åŒ–|æŒ¯ã‚Šè¿”ã‚Š|ç¶™ç¶š/.test(L)) return s*2 + m;
                return 0;
              }
              function choosingTips(){
                const map = {
                  t01:['äº‹å‰èª¬æ˜ã‚„ãƒ—ãƒ­ã‚»ã‚¹ã®å¯è¦–åŒ–ãŒã‚ã‚‹','ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚„äº‹ä¾‹ãŒè±Šå¯Œ','æ¯”è¼ƒæ¤œè¨ã®ä½™åœ°ãŒã‚ã‚‹'],
                  t02:['ç›¸è«‡/ãƒã‚§ãƒƒã‚¯ã®ä¼´èµ°ãŒã‚ã‚‹','æŸ”è»Ÿã«èª¿æ•´ã§ãã‚‹','ç´å¾—ãŒå¾—ã‚‰ã‚Œã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³'],
                  t03:['çŸ­æœŸãƒ—ãƒ©ãƒ³ã‚„æ˜ç¢ºãªæˆæœæŒ‡æ¨™','å†™çœŸã§æ¯”è¼ƒã§ãã‚‹äº‹ä¾‹','æ—©ã„ä»®èª¬æ¤œè¨¼ã‚’æ”¯æ´'],
                  t04:['æ›´æ–°ææ¡ˆã‚„ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’æ”¯æ´','å°ã•ãè©¦ã—ã¦èª¿æ•´ã§ãã‚‹','å¤‰åŒ–ã®å®Ÿæ„Ÿã‚’å¯è¦–åŒ–'],
                  t05:['ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®ä¸–ç•Œè¦³ãŒä¸€è²«','äº‹ä¾‹å†™çœŸãŒè±Šå¯Œ','ç›¸æ€§ã®åˆã†é›°å›²æ°—'],
                  t06:['ç¶™ç¶šã‚µãƒãƒ¼ãƒˆã‚„ç¿’æ…£åŒ–ã®ä»•çµ„ã¿','å®šæœŸçš„ãªæŒ¯ã‚Šè¿”ã‚Š','ç„¡ç†ã®ãªã„èª¿æ•´']
                };
                const arr = (map[typeId] || map.t01).slice();
                return arr.sort((a,b)=> labelWeight(b) - labelWeight(a));
              }
              function inferStrategyPreference(){
                try{
                  const raw = localStorage.getItem('glowup:metrics');
                  const store = raw? JSON.parse(raw):{};
                  const events = Array.isArray(store?.events)? store.events: [];
                  // find deltas between search and subsequent adoption in recent window
                  const recent = events.slice(-300);
                  const searches = recent.filter(e=> e.type==='search');
                  const adoptions = recent.filter(e=> e.type==='adoption');
                  if(!searches.length || !adoptions.length) return { fast:false, habit:false, s:searches.length||0, a:adoptions.length||0, medianMs:null };
                  const adTimes = adoptions.map(e=> new Date(e.t).getTime()).sort((a,b)=> a-b);
                  const deltas = [];
                  for(const s of searches){
                    const st = new Date(s.t).getTime();
                    const a = adTimes.find(t=> t>=st);
                    if(a){ deltas.push(a-st); }
                  }
                  if(!deltas.length) return { fast:false, habit:false, s:searches.length||0, a:adoptions.length||0, medianMs:null };
                  const median = deltas.sort((a,b)=> a-b)[Math.floor(deltas.length/2)];
                  const oneDay = 24*60*60*1000;
                  const fastPref = median <= oneDay; // adoptionãŒæ¦‚ã­1æ—¥ä»¥å†…
                  // queryèªå½™ã§è£œå¼·
                  const qTokens = searches.map(s=> String(s.query||'').toLowerCase());
                  const fastWords = qTokens.filter(q=> /çŸ­æœŸ|å³|æ—©|æœ€çŸ­|ãƒ—ãƒ©ãƒ³/.test(q)).length;
                  const habitWords = qTokens.filter(q=> /ç¿’æ…£|ç¶šã‘|ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³|é€±æ¬¡|ç¶™ç¶š/.test(q)).length;
                  const habitPref = (!fastPref && habitWords>fastWords) || (median>oneDay);
                  return { fast: fastPref, habit: habitPref, s:searches.length||0, a:adoptions.length||0, medianMs: median };
                }catch{ return { fast:false, habit:false, s:0, a:0, medianMs:null }; }
              }
              function strategyWeight(lab){
                const ax = axes || {};
                const s = Number(ax.support)||0, c = Number(ax.change)||0, m = Number(ax.motivation)||0, ctrl = Number(ax.control)||0;
                const pref = inferStrategyPreference();
                const L = String(lab);
                let w = 0;
                if(/å³åŠ¹|å°ã•ãªå¤‰æ›´|å†™çœŸ|æ¯”è¼ƒ|ã‚¹ãƒ—ãƒªãƒ³ãƒˆ/.test(L)) w += (pref.fast? 3: 0) + c*2 + m;
                if(/ç¿’æ…£|ãƒ«ãƒ¼ãƒ«åŒ–|å®šæœŸ|æŒ¯ã‚Šè¿”ã‚Š|ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³/.test(L)) w += (pref.habit? 3: 0) + s*2 + m;
                if(/ç›®çš„|è©•ä¾¡æŒ‡æ¨™|æ˜æ–‡åŒ–/.test(L)) w += m*2 + ctrl;
                if(/é€æ˜æ€§|æ„æ€æ±ºå®š|æ¯”è¼ƒæ¤œè¨/.test(L)) w += ctrl*2 + m;
                return w;
              }
              function strategyTips(){
                const tips = [
                  'å³åŠ¹æ€§ã®ã‚ã‚‹å°ã•ãªå¤‰æ›´ã‚’è©¦ã™ï¼ˆå†™çœŸã‚„æ¯”è¼ƒã§æ¤œè¨¼ï¼‰',
                  'çŸ­ã„ã‚¹ãƒ—ãƒªãƒ³ãƒˆã§è©¦ã™ï¼ˆ1ã€œ2é€±é–“ï¼‰',
                  'æ™‚é–“ã‚’ã‹ã‘ã¦ç¿’æ…£åŒ–ã™ã‚‹ï¼ˆãƒ«ãƒ¼ãƒ«åŒ–/å®šæœŸæŒ¯ã‚Šè¿”ã‚Šï¼‰',
                  'å®šæœŸãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’è¨­ã‘ã‚‹ï¼ˆç›¸è«‡/ç¢ºèªï¼‰',
                  'ç›®çš„ã‚’æ˜æ–‡åŒ–ã—è©•ä¾¡æŒ‡æ¨™ã‚’æ±ºã‚ã‚‹',
                  'æ„æ€æ±ºå®šã®é€æ˜æ€§ã‚’ç¢ºä¿ã—ã€æ¯”è¼ƒæ¤œè¨ã™ã‚‹'
                ];
                const uniq = []; tips.forEach(t=>{ if(!uniq.includes(t)) uniq.push(t); });
                return uniq.sort((a,b)=> strategyWeight(b) - strategyWeight(a)).slice(0,4);
              }
              const wrap = document.createElement('div'); wrap.className='block';
              const title = document.createElement('div'); title.className='block-title'; title.textContent='é€²ã‚æ–¹ã®è¦–ç‚¹'; wrap.appendChild(title);
              const cols = [ ['è€ƒãˆæ–¹ã®ç‰¹å¾´',mindsetTips()], ['é¸ã³æ–¹ï¼ˆãŠåº—/äººï¼‰', choosingTips()], ['é€²ã‚æ–¹ï¼ˆå³åŠ¹æ€§/ç¿’æ…£ï¼‰', strategyTips()] ];
              const grid = document.createElement('div'); grid.className='stack'; grid.style.gap='10px';
              cols.forEach(([h, arr])=>{
                const box=document.createElement('div'); const sh=document.createElement('h4'); sh.textContent=h; box.appendChild(sh);
                const ul=document.createElement('ul');
                // ranking or reason
                let sorted = arr.slice(); let weights = [];
                let showRanks = false; let reasonText = '';
                if(/é¸ã³æ–¹/.test(h)){
                  sorted = arr.slice().sort((a,b)=> labelWeight(b)-labelWeight(a));
                  weights = sorted.map(x=> labelWeight(x));
                  const sumAxes = ['support','change','control','motivation'].map(k=> Number((axes||{})[k])||0).reduce((p,c)=> p+c, 0);
                  const spread = (weights.length? (Math.max(...weights)-Math.min(...weights)): 0);
                  showRanks = spread > 0.5 && sumAxes > 0;
                  if(!showRanks){ reasonText = sumAxes===0? 'â€» è»¸ã®å·®ãŒå°ã•ã„ãŸã‚ã€é¸ã³æ–¹ã®é †ä½ä»˜ã‘ã¯è¡Œã£ã¦ã„ã¾ã›ã‚“ï¼ˆåŒç¨‹åº¦ï¼‰ã€‚' : 'â€» è»¸å·®ãŒåƒ…å·®ã®ãŸã‚ã€é †ä½ã¯å‚è€ƒç¨‹åº¦ï¼ˆåŒç¨‹åº¦ï¼‰ã€‚'; }
                }
                if(/é€²ã‚æ–¹/.test(h)){
                  sorted = arr.slice().sort((a,b)=> strategyWeight(b)-strategyWeight(a));
                  weights = sorted.map(x=> strategyWeight(x));
                  const pref = inferStrategyPreference();
                  const spread = (weights.length? (Math.max(...weights)-Math.min(...weights)): 0);
                  showRanks = spread > 0.5 && ((pref.s||0) > 2 || (pref.a||0) > 1);
                  if(!showRanks){ reasonText = 'â€» è¡Œå‹•ãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã„ãŸã‚ã€é€²ã‚æ–¹ã®é †ä½ä»˜ã‘ã¯è¡Œã£ã¦ã„ã¾ã›ã‚“ï¼ˆåŒç¨‹åº¦ï¼‰ã€‚'; }
                }
                sorted.forEach((t,i)=>{ const li=document.createElement('li'); li.textContent=t; if(showRanks){ const b=document.createElement('span'); b.textContent=` å„ªå…ˆåº¦ ${i+1}`; b.style.marginLeft='6px'; b.style.padding='2px 6px'; b.style.border='1px solid var(--color-border)'; b.style.borderRadius='999px'; b.style.fontSize='12px'; li.appendChild(b); } ul.appendChild(li); });
                if(!showRanks && reasonText){ const p=document.createElement('p'); p.className='muted'; p.textContent=reasonText; box.appendChild(p); }
                box.appendChild(ul); grid.appendChild(box);
              });
              wrap.appendChild(grid);
              // æ ¹æ‹ ã‚’è¡¨ç¤ºï¼ˆä¸Šä½è»¸ï¼‰
              try{
                const pairs = [['support','å¯„ã‚Šæ·»ã„/ç›¸è«‡'],['change','å¤‰åŒ–ã®å¼·ã•'],['control','ä¸»å°æ¨©/å…±åŒæ±ºå®š'],['motivation','ç›®çš„ã®æ˜ç¢ºã•']]
                  .map(([k,lab])=>({ k, lab, v: Number((axes||{})[k])||0 }))
                  .sort((a,b)=> b.v - a.v).slice(0,2);
                const note = document.createElement('p'); note.className='muted'; note.textContent = pairs.length? `â€» ã‚ãªãŸã®å›ç­”ï¼ˆè»¸ï¼š${pairs.map(p=> p.lab).join('ãƒ»')}ï¼‰ã«åŸºã¥ã„ã¦ä¸¦ã³ã‚’èª¿æ•´ã—ã¦ã„ã¾ã™ã€‚` : 'â€» ã‚ãªãŸã®å›ç­”ã«åŸºã¥ã„ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚';
                wrap.appendChild(note);
              }catch{}
              article.appendChild(wrap);
            })();

            // â‘¢ å¼·ã¿ã®å†å®šç¾©ï¼ˆè‡ªå·±å¦å®šã‚’é˜²ãï¼‰
            const strongH = document.createElement('h3'); strongH.textContent = 'ã“ã‚Œã¯ã€Œæ‚ªã„ã€ã§ã¯ãªãã€ã‚ãªãŸã®å¼·ã¿ã§ã™'; article.appendChild(strongH);
            const strongP = document.createElement('p'); strongP.textContent = copy.strength || 'ã‚ãªãŸã¯è‡ªåˆ†ã«åˆã†é€²ã‚æ–¹ã‚’é¸ã¹ã‚‹äººã§ã™ã€‚'; article.appendChild(strongP);

            // â‘¢-2 å¼·ã¿ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆãƒãƒƒãƒ—åŒ–ï¼‰
            (function(){
              const highlightsWrap = document.createElement('div'); highlightsWrap.className='highlights';
              try{
                const text = (copy.strength || '').toString();
                const parts = text.split(/[ã€ã€‚ãƒ»\n]/).map(s=> s.trim()).filter(s=> s.length>0 && s.length<=30);
                const uniq = [];
                for(const p of parts){ if(!uniq.includes(p)) uniq.push(p); }
                (uniq.slice(0,3)).forEach(h=>{ const span = document.createElement('span'); span.className='chip'; span.textContent=h; highlightsWrap.appendChild(span); });
              }catch{}
              if(!highlightsWrap.children.length){ const span = document.createElement('span'); span.className='muted'; span.textContent='è¦ç‚¹ã‚’æŠ½å‡ºã—ã¦ã„ã¾ã™'; highlightsWrap.appendChild(span); }
              article.appendChild(highlightsWrap);
            })();

            // â‘£ ã“ã®è¦‹ç«‹ã¦ã«ãªã£ãŸç†ç”±ï¼ˆSTEP2ã®ç­”ãˆåˆã‚ã›ï¼‰â†’ ãƒ–ãƒ­ãƒƒã‚¯ï¼‹æ¨ªã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
            (function(){
              const whyBlock = document.createElement('div'); whyBlock.className='block';
              const whyTitle = document.createElement('div'); whyTitle.className='block-title'; whyTitle.textContent='ã“ã®è¦‹ç«‹ã¦ã«ãªã£ãŸç†ç”±'; whyBlock.appendChild(whyTitle);
              const items = [];
              try{
                const stored = JSON.parse(localStorage.getItem('fineme:diagnosis:latest')||'{}');
                const axes = stored?.step2?.scores?.axes || {};
                const topAxes = Object.entries(axes).filter(([k,v])=> typeof v==='number').sort((a,b)=> (b[1]||0) - (a[1]||0)).slice(0,4);
                topAxes.forEach(([code])=>{
                  const map = {
                    motivation:['å¤‰ã‚ã‚ŠãŸã„ç†ç”±ãŒæ˜ç¢ºï¼ˆæ·±ã•ãŒã‚ã‚‹ï¼‰','ğŸ¯'],
                    support:['ã‚µãƒãƒ¼ãƒˆã‚’å¿…è¦ã¨ã™ã‚‹åº¦åˆã„ãŒé«˜ã„','ğŸ¤'],
                    change:['æ±‚ã‚ã‚‹å¤‰åŒ–ã®å¼·ã•ãŒé«˜ã„','ğŸ”„'],
                    control:['ä¸»å°æ¨©ã‚’è‡ªåˆ†ã§æŒã¡ãŸã„ï¼ˆã¾ãŸã¯å…±åŒã§ï¼‰','ğŸ§ '],
                  };
                  const pair = map[code];
                  items.push({ label: (pair? pair[0]: ('é¸ã³æ–¹è»¸('+code+')ã‚’é‡è¦–ã™ã‚‹')), emoji: (pair? pair[1]: 'ğŸ§­') });
                });
                if(axes.value){ items.push({ label:'ä¾¡å€¤è¦³ã¯ã€Œ'+ String(axes.value) +'ã€ãŒè¿‘ã„ã¨æ„Ÿã˜ã¦ã„ã¾ã™', emoji:'ğŸ’' }); }
              }catch{}
              if(!items.length){ items.push({ label:'ã‚ãªãŸã®é¸æŠã«åŸºã¥ã„ã¦å°ã‹ã‚ŒãŸçµæœã§ã™', emoji:'ğŸ§­' }); }

              const slider = document.createElement('div'); slider.className='result-slider';
              const controls = document.createElement('div'); controls.className='slider-controls';
              const btnPrev = document.createElement('button'); btnPrev.className='btn btn-ghost'; btnPrev.setAttribute('aria-label','å‰ã¸'); btnPrev.textContent='â€¹';
              const btnNext = document.createElement('button'); btnNext.className='btn btn-ghost'; btnNext.setAttribute('aria-label','æ¬¡ã¸'); btnNext.textContent='â€º';
              controls.appendChild(btnPrev); controls.appendChild(btnNext); slider.appendChild(controls);
              const track = document.createElement('div'); track.className='slider-track';
              items.forEach(it=>{
                const card = document.createElement('div'); card.className='slide-card';
                const emoji = document.createElement('div'); emoji.className='slide-emoji'; emoji.textContent = it.emoji || 'âœ¨'; card.appendChild(emoji);
                const lab = document.createElement('div'); lab.className='slide-label'; lab.textContent=it.label; card.appendChild(lab);
                track.appendChild(card);
              });
              slider.appendChild(track);
              whyBlock.appendChild(slider);

              function onArrow(dir){ try{ const delta = dir==='next' ? Math.floor(track.clientWidth*0.8) : -Math.floor(track.clientWidth*0.8); track.scrollBy({ left: delta, behavior:'smooth' }); }catch{} }
              btnPrev.addEventListener('click', ()=> onArrow('prev'));
              btnNext.addEventListener('click', ()=> onArrow('next'));

              article.appendChild(whyBlock);
            })();

            // â‘£-2 ä»£æ›¿æ¡ˆã‚¿ãƒ–ï¼ˆä¿å®ˆ/æ¨™æº–/æ”»ã‚ï¼‰
            (function(){
              const wrap = document.createElement('div'); wrap.className='block';
              const title = document.createElement('div'); title.className='block-title'; title.textContent='åˆ¥ã®è¦‹æ–¹ï¼ˆä¿å®ˆ/æ¨™æº–/æ”»ã‚ï¼‰'; wrap.appendChild(title);
              const tabs = document.createElement('div'); tabs.style.display='flex'; tabs.style.gap='8px'; tabs.style.margin='8px 0';
              const btnConservative = document.createElement('button'); btnConservative.className='btn btn-ghost'; btnConservative.textContent='ä¿å®ˆ';
              const btnStandard = document.createElement('button'); btnStandard.className='btn btn-ghost'; btnStandard.textContent='æ¨™æº–';
              const btnAggressive = document.createElement('button'); btnAggressive.className='btn btn-ghost'; btnAggressive.textContent='æ”»ã‚';
              tabs.appendChild(btnConservative); tabs.appendChild(btnStandard); tabs.appendChild(btnAggressive); wrap.appendChild(tabs);
              const list = document.createElement('div'); list.className='highlights'; wrap.appendChild(list);
              function setItems(kind){
                const items = [];
                if(kind==='ä¿å®ˆ'){
                  items.push('å°ã•ãªå¤‰æ›´ã‚’è©¦ã™ï¼ˆğŸ§ªï¼‰'); items.push('å†™çœŸã§æ¯”è¼ƒã—ã¦ç´å¾—ï¼ˆğŸ“¸ï¼‰'); items.push('å†èª¿æ•´å‰æã§é€²ã‚ã‚‹ï¼ˆğŸ”ï¼‰');
                }else if(kind==='æ”»ã‚'){
                  items.push('å¤‰åŒ–ã‚’å®Ÿæ„Ÿã§ãã‚‹ææ¡ˆï¼ˆğŸ”„ï¼‰'); items.push('çŸ­ã„ã‚¹ãƒ—ãƒªãƒ³ãƒˆã§æ›´æ–°ï¼ˆğŸƒï¼‰'); items.push('å®‰å…¨ç¶²ã‚’ç”¨æ„ã—ãŸæŒ‘æˆ¦ï¼ˆğŸ›¡ï¸ï¼‰');
                }else{
                  items.push('ç›®çš„ã‚’æ˜æ–‡åŒ–ã—ã¦é€²ã‚ã‚‹ï¼ˆğŸ—ºï¸ï¼‰'); items.push('ç›¸è«‡/ç¢ºèªã®ä¼´èµ°ï¼ˆğŸ¤ï¼‰'); items.push('ä¸–ç•Œè¦³ãŒåˆã†ç›¸æ‰‹ã‚’é¸ã¶ï¼ˆâœ¨ï¼‰');
                }
                list.innerHTML='';
                items.forEach(t=>{ const span=document.createElement('span'); span.className='chip'; span.textContent=t; list.appendChild(span); });
              }
              // åˆæœŸè¡¨ç¤ºï¼šæ¨™æº–
              setItems('æ¨™æº–');
              btnConservative.addEventListener('click', ()=> setItems('ä¿å®ˆ'));
              btnStandard.addEventListener('click', ()=> setItems('æ¨™æº–'));
              btnAggressive.addEventListener('click', ()=> setItems('æ”»ã‚'));
              article.appendChild(wrap);
            })();

            // â‘¥ æ¬¡ã«ã‚„ã‚‹ãªã‚‰ï¼ˆè¡Œå‹•ä¿ƒé€²ï¼šä¸¡ãƒ‹ãƒ¼ã‚ºå¯¾å¿œï¼‰
            (function(){
              const diag = (function(){ try{ return JSON.parse(localStorage.getItem('fineme:diagnosis:latest')||'{}'); }catch{ return {}; } })();
              function recommendCategories(diag){
                const typeId = String(diag?.intent?.type_id || diag?.step2?.classification?.type_id || '');
                const TYPE_BASE = {
                  w01: ['consulting','eyebrow','hair','diagnosis'],
                  w02: ['hair','eyebrow','esthetic','fashion'],
                  w03: ['consulting','photo','marriage','gym'],
                  w04: ['fashion','makeup','photo','consulting'],
                  w05: ['diagnosis','fashion','hair','makeup'],
                  w06: ['fashion','makeup','hair','photo'],
                  w07: ['photo','makeup','fashion','hair'],
                  w08: ['eyebrow','whitening','orthodontics','hairremoval']
                };
                const baseList = TYPE_BASE[typeId] || [];
                const baseBoost = (cat)=>{ const idx = baseList.indexOf(cat); if(idx===0) return 60; if(idx===1) return 40; if(idx===2) return 25; if(idx>=3) return 15; return 10; };
                const axes = (diag?.step2?.scores?.axes) || {};
                const AXIS_WEIGHTS = {
                  natural: { hair:0.25, eyebrow:0.2, esthetic:0.2, fashion:0.15 },
                  evidence: { diagnosis:0.35, orthodontics:0.25, whitening:0.25 },
                  guidance: { consulting:0.35, marriage:0.25 },
                  customization: { fashion:0.3, makeup:0.25, nail:0.2 },
                  gentle: { esthetic:0.25, makeup:0.2, nail:0.2 }
                };
                const CATS_ALL = ['consulting','gym','makeup','hair','diagnosis','fashion','photo','marriage','eyebrow','hairremoval','esthetic','whitening','orthodontics','nail'];
                const scores = {};
                for(const c of CATS_ALL){ let s = baseBoost(c); for(const ax in AXIS_WEIGHTS){ const v = Number(axes[ax]||0); const w = AXIS_WEIGHTS[ax][c] || 0; s += v * w; } scores[c] = Math.max(0, Math.min(100, Math.round(s))); }
                const sorted = Object.keys(scores).sort((a,b)=> scores[b]-scores[a]);
                return { scores, sorted };
              }
              function labelCategory(cat){
                const map = {
                  consulting:'ã‚³ãƒ³ã‚µãƒ«/ç›¸è«‡', gym:'ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ã‚¸ãƒ ', makeup:'ãƒ¡ã‚¤ã‚¯', hair:'ç¾å®¹å®¤', diagnosis:'è¨ºæ–­', fashion:'ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³', photo:'å†™çœŸ/æ’®å½±', marriage:'å©šæ´»/å°è±¡', eyebrow:'çœ‰', hairremoval:'è„±æ¯›', esthetic:'ã‚¨ã‚¹ãƒ†', whitening:'ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‹ãƒ³ã‚°', orthodontics:'çŸ¯æ­£', nail:'ãƒã‚¤ãƒ«'
                };
                return map[cat] || cat;
              }
              const wrap = document.createElement('div'); wrap.className='block';
              const title = document.createElement('div'); title.className='block-title'; title.textContent='æ¬¡ã«ã‚„ã‚‹ãªã‚‰'; wrap.appendChild(title);
              const grid = document.createElement('div'); grid.className='stack'; grid.style.gap='10px';
              // å·¦ï¼šç›®çš„ãŒæ±ºã¾ã£ã¦ã„ã‚‹ï¼ˆã‚«ãƒ†ã‚´ãƒªã‹ã‚‰æ¢ã™ï¼‰
              const left = document.createElement('div');
              const lh = document.createElement('h4'); lh.textContent='ç›®çš„ãŒæ±ºã¾ã£ã¦ã„ã‚‹ï¼ˆã‚«ãƒ†ã‚´ãƒªã‹ã‚‰æ¢ã™ï¼‰'; left.appendChild(lh);
              const cats = recommendCategories(diag).sorted.slice(0,6);
              const catWrap = document.createElement('div'); catWrap.className='cluster'; catWrap.style.flexWrap='wrap'; catWrap.style.gap='8px';
              cats.forEach(c=>{ const btn=document.createElement('a'); btn.className='btn btn-ghost'; btn.textContent=labelCategory(c); const u=new URL(location.href); u.pathname = (location.pathname.includes('/diagnosis/')? '../pages/search.html' : 'pages/search.html'); u.search = ''; u.searchParams.set('category', c); btn.href = u.toString(); catWrap.appendChild(btn); });
              left.appendChild(catWrap);
              // å³ï¼šã¾ã æ±ºã‚ã¦ã„ãªã„ï¼ˆã‚¿ã‚¤ãƒ—ã«åˆã†ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ï¼‰
              const right = document.createElement('div');
              const rh = document.createElement('h4'); rh.textContent='ã¾ã æ±ºã‚ã¦ã„ãªã„ï¼ˆã‚¿ã‚¤ãƒ—ã«åˆã†ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ï¼‰'; right.appendChild(rh);
              const actWrap = document.createElement('div'); actWrap.className='cluster'; actWrap.style.flexWrap='wrap'; actWrap.style.gap='8px';
              const btnReco = document.createElement('a'); btnReco.className='btn'; btnReco.textContent='ã‚¿ã‚¤ãƒ—ã«åˆã†ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼3é¸';
              try{ btnReco.style.setProperty('color','#fff','important'); }catch{}
              { const u=new URL(location.href); u.pathname = (location.pathname.includes('/diagnosis/')? '../pages/search.html' : 'pages/search.html'); u.search = ''; u.searchParams.set('diag','1'); btnReco.href = u.toString(); }
              const btnGuide = document.createElement('a'); btnGuide.className='btn btn-ghost'; btnGuide.textContent='å¢æŠœã‘ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹'; { const u=new URL(location.href); u.pathname = (location.pathname.includes('/diagnosis/')? '../pages/feature.html' : 'pages/feature.html'); btnGuide.href = u.toString(); }
              actWrap.appendChild(btnReco); actWrap.appendChild(btnGuide);
              right.appendChild(actWrap);
              grid.appendChild(left); grid.appendChild(right);
              wrap.appendChild(grid);
              article.appendChild(wrap);
            })();

            // â‘¤ ä»Šã®æ®µéšã§å‘ã„ã¦ã„ã‚‹å¤‰åŒ– â†’ ãƒ–ãƒ­ãƒƒã‚¯ï¼‹æ¨ªã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
            (function(){
              const fitBlock = document.createElement('div'); fitBlock.className='block';
              const fitTitle = document.createElement('div'); fitTitle.className='block-title'; fitTitle.textContent='ä»Šã®æ®µéšã§å‘ã„ã¦ã„ã‚‹å¤‰åŒ–'; fitBlock.appendChild(fitTitle);
              const rawItems = (copy.fit||[]).slice(0,6);
              if(!rawItems.length){ rawItems.push(copy.logic || 'ã‚ãªãŸã«åˆã†é€²ã‚æ–¹ã‚’å„ªå…ˆã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚'); }
              const items = rawItems.map(t=>{
                const s = String(t);
                let emoji = 'âœ¨';
                if(/è©¦|å°ã•|ãƒ†ã‚¹ãƒˆ/.test(s)) emoji = 'ğŸ§ª';
                else if(/ç›¸è«‡|ä¼´èµ°|å¯„ã‚Šæ·»|ç¢ºèª/.test(s)) emoji = 'ğŸ¤';
                else if(/å¤‰åŒ–|ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ|æŒ‘æˆ¦/.test(s)) emoji = 'ğŸ”„';
                else if(/è¨ˆç”»|ã‚´ãƒ¼ãƒ«|æ‰‹é †/.test(s)) emoji = 'ğŸ—ºï¸';
                else if(/å®Ÿç¸¾|çµæœ|ä¸Šä½/.test(s)) emoji = 'ğŸ“ˆ';
                return { label: s, emoji };
              });

              const slider = document.createElement('div'); slider.className='result-slider';
              const controls = document.createElement('div'); controls.className='slider-controls';
              const btnPrev = document.createElement('button'); btnPrev.className='btn btn-ghost'; btnPrev.setAttribute('aria-label','å‰ã¸'); btnPrev.textContent='â€¹';
              const btnNext = document.createElement('button'); btnNext.className='btn btn-ghost'; btnNext.setAttribute('aria-label','æ¬¡ã¸'); btnNext.textContent='â€º';
              controls.appendChild(btnPrev); controls.appendChild(btnNext); slider.appendChild(controls);
              const track = document.createElement('div'); track.className='slider-track';
              items.forEach(it=>{
                const card = document.createElement('div'); card.className='slide-card';
                const emoji = document.createElement('div'); emoji.className='slide-emoji'; emoji.textContent = it.emoji || 'âœ¨'; card.appendChild(emoji);
                const lab = document.createElement('div'); lab.className='slide-label'; lab.textContent=it.label; card.appendChild(lab);
                track.appendChild(card);
              });
              slider.appendChild(track);
              fitBlock.appendChild(slider);

              function onArrow(dir){ try{ const delta = dir==='next' ? Math.floor(track.clientWidth*0.8) : -Math.floor(track.clientWidth*0.8); track.scrollBy({ left: delta, behavior:'smooth' }); }catch{} }
              btnPrev.addEventListener('click', ()=> onArrow('prev'));
              btnNext.addEventListener('click', ()=> onArrow('next'));

              article.appendChild(fitBlock);
            })();

            // â‘¥ æ¬¡ã®ä¸€æ‰‹ï¼ˆæœ€å¤§2ã¤ï¼‰
            const nextActions = document.createElement('div'); nextActions.className='result-actions';
            const goSearch = document.createElement('a'); goSearch.href='../pages/search.html'; goSearch.className='btn'; goSearch.textContent='ä»Šã®è‡ªåˆ†ã«åˆã†é¸æŠè‚¢ã‚’è¦‹ã‚‹'; nextActions.appendChild(goSearch);
            const goMypage = document.createElement('a'); goMypage.href='../pages/mypage/diagnosis.html'; goMypage.className='btn'; goMypage.textContent='å°‘ã—è€ƒãˆã‚‹ãŸã‚ã«ä¿å­˜ã™ã‚‹'; nextActions.appendChild(goMypage);
            article.appendChild(nextActions);

            

            // â‘¥-2 ææ¡ˆã‚«ãƒ¼ãƒ‰ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰â†’ çµµæ–‡å­—åŒ–ï¼†ã‚¿ã‚¤ãƒ—/è»¸ã§ä¸¦ã³æ›¿ãˆ
            (function(){
              function baseSuggestions(){
                return [
                  { label: 'ãƒ˜ã‚¢ã‚«ãƒƒãƒˆ/ã‚«ãƒ©ãƒ¼', emoji: 'ğŸ’‡â€â™€ï¸', href: '../pages/search.html?keyword=ãƒ˜ã‚¢' },
                  { label: 'ãƒ¡ã‚¤ã‚¯ç›¸è«‡', emoji: 'ğŸ’„', href: '../pages/search.html?keyword=ãƒ¡ã‚¤ã‚¯' },
                  { label: 'ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ç›¸è«‡', emoji: 'ğŸ‘—', href: '../pages/search.html?keyword=ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³' },
                  { label: 'å†™çœŸæ’®å½±', emoji: 'ğŸ“¸', href: '../pages/search.html?keyword=å†™çœŸ' },
                  { label: 'ãƒœãƒ‡ã‚£ãƒ¡ã‚¤ã‚¯', emoji: 'ğŸ‹ï¸', href: '../pages/search.html?keyword=ã‚¸ãƒ ' },
                  { label: 'å©šæ´»ã‚µãƒãƒ¼ãƒˆ', emoji: 'ğŸ’', href: '../pages/search.html?keyword=å©šæ´»' },
                ];
              }

              function scoreSuggestions(typeId, axes){
                const list = baseSuggestions();
                const score = Object.fromEntries(list.map(s=> [s.label, 0]));
                // ã‚¿ã‚¤ãƒ—åˆ¥ã®åˆæœŸé‡ã¿ä»˜ã‘
                const byType = {
                  t01: ['ãƒ¡ã‚¤ã‚¯ç›¸è«‡','ãƒ˜ã‚¢ã‚«ãƒƒãƒˆ/ã‚«ãƒ©ãƒ¼','ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ç›¸è«‡','å†™çœŸæ’®å½±','ãƒœãƒ‡ã‚£ãƒ¡ã‚¤ã‚¯','å©šæ´»ã‚µãƒãƒ¼ãƒˆ'], // æ…é‡ãƒ»ç´å¾—
                  t02: ['ãƒ¡ã‚¤ã‚¯ç›¸è«‡','ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ç›¸è«‡','ãƒ˜ã‚¢ã‚«ãƒƒãƒˆ/ã‚«ãƒ©ãƒ¼','å†™çœŸæ’®å½±','å©šæ´»ã‚µãƒãƒ¼ãƒˆ','ãƒœãƒ‡ã‚£ãƒ¡ã‚¤ã‚¯'], // å¯„ã‚Šæ·»ã„
                  t03: ['å†™çœŸæ’®å½±','ãƒœãƒ‡ã‚£ãƒ¡ã‚¤ã‚¯','ãƒ˜ã‚¢ã‚«ãƒƒãƒˆ/ã‚«ãƒ©ãƒ¼','ãƒ¡ã‚¤ã‚¯ç›¸è«‡','ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ç›¸è«‡','å©šæ´»ã‚µãƒãƒ¼ãƒˆ'], // æœ€çŸ­
                  t04: ['ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ç›¸è«‡','ãƒ˜ã‚¢ã‚«ãƒƒãƒˆ/ã‚«ãƒ©ãƒ¼','å†™çœŸæ’®å½±','ãƒ¡ã‚¤ã‚¯ç›¸è«‡','ãƒœãƒ‡ã‚£ãƒ¡ã‚¤ã‚¯','å©šæ´»ã‚µãƒãƒ¼ãƒˆ'], // å¤‰åŒ–
                  t05: ['å†™çœŸæ’®å½±','ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ç›¸è«‡','ãƒ¡ã‚¤ã‚¯ç›¸è«‡','ãƒ˜ã‚¢ã‚«ãƒƒãƒˆ/ã‚«ãƒ©ãƒ¼','å©šæ´»ã‚µãƒãƒ¼ãƒˆ','ãƒœãƒ‡ã‚£ãƒ¡ã‚¤ã‚¯'], // ç›´æ„Ÿ/ä¸–ç•Œè¦³
                  t06: ['ãƒ¡ã‚¤ã‚¯ç›¸è«‡','ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ç›¸è«‡','å†™çœŸæ’®å½±','ãƒ˜ã‚¢ã‚«ãƒƒãƒˆ/ã‚«ãƒ©ãƒ¼','å©šæ´»ã‚µãƒãƒ¼ãƒˆ','ãƒœãƒ‡ã‚£ãƒ¡ã‚¤ã‚¯'], // ä¼´èµ°
                };
                (byType[typeId]||list.map(s=> s.label)).forEach((lab, i)=>{ score[lab] += (list.length - i); });

                // è»¸ã‚¹ã‚³ã‚¢ã«ã‚ˆã‚‹å¾®èª¿æ•´
                try{
                  const ax = axes || {};
                  if(Number(ax.support) > 0){ score['ãƒ¡ã‚¤ã‚¯ç›¸è«‡'] += 3; score['ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ç›¸è«‡'] += 2; }
                  if(Number(ax.change) > 0){ score['å†™çœŸæ’®å½±'] += 3; score['ãƒœãƒ‡ã‚£ãƒ¡ã‚¤ã‚¯'] += 2; }
                  if(Number(ax.control) > 0){ score['ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ç›¸è«‡'] += 2; score['ãƒ˜ã‚¢ã‚«ãƒƒãƒˆ/ã‚«ãƒ©ãƒ¼'] += 2; }
                  if(Number(ax.motivation) > 0){ score['ãƒ˜ã‚¢ã‚«ãƒƒãƒˆ/ã‚«ãƒ©ãƒ¼'] += 2; }
                }catch{}

                return list.sort((a,b)=> (score[b.label]||0) - (score[a.label]||0));
              }

              // å…¥åŠ›ï¼ˆã‚¿ã‚¤ãƒ—ID/è»¸ï¼‰
              let typeId = 't01'; let axes = {};
              try{
                const stored = JSON.parse(localStorage.getItem('fineme:diagnosis:latest')||'{}');
                typeId = (stored?.step2?.classification?.type_id) || typeId;
                axes = stored?.step2?.scores?.axes || {};
              }catch{}

              let suggestions = scoreSuggestions(typeId, axes);
              // å„ãƒªãƒ³ã‚¯ã«ã‚¿ã‚¤ãƒ—åã‚’ä»˜ä¸ã—ã¦æ¤œç´¢ç²¾åº¦ã‚’å‘ä¸Š
              const typeName = copy?.name || '';
              suggestions = suggestions.map(s=> ({ ...s, href: `${s.href}%20${encodeURIComponent(typeName)}` }));

              const slider = document.createElement('div'); slider.className='result-slider';
              const controls = document.createElement('div'); controls.className='slider-controls';
              const btnPrev = document.createElement('button'); btnPrev.className='btn btn-ghost'; btnPrev.setAttribute('aria-label','å‰ã¸'); btnPrev.textContent='â€¹';
              const btnNext = document.createElement('button'); btnNext.className='btn btn-ghost'; btnNext.setAttribute('aria-label','æ¬¡ã¸'); btnNext.textContent='â€º';
              const btnInfo = document.createElement('button'); btnInfo.className='info-btn'; btnInfo.setAttribute('aria-label','ä¸¦ã³ã®ç†ç”±'); btnInfo.textContent='ä¸¦ã³ã®ç†ç”±';
              controls.appendChild(btnPrev); controls.appendChild(btnNext); controls.appendChild(btnInfo); slider.appendChild(controls);

              const track = document.createElement('div'); track.className='slider-track';
              suggestions.forEach(s=>{
                const a = document.createElement('a'); a.className='slide-card'; a.href=s.href;
                a.addEventListener('click', ()=>{
                  try{ window.dispatchEvent(new CustomEvent('fineme:analytics', { detail: { event:'result_slide_click', label: s.label, type: copy.name } })); }catch{}
                });
                const emoji = document.createElement('div'); emoji.className='slide-emoji'; emoji.textContent = s.emoji || 'âœ¨'; a.appendChild(emoji);
                const lab = document.createElement('div'); lab.className='slide-label'; lab.textContent=s.label; a.appendChild(lab);
                track.appendChild(a);
              });
              slider.appendChild(track);
              // ãƒãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼å†…å®¹
              const pop = document.createElement('div'); pop.className='popover';
              const popTitle = document.createElement('div'); popTitle.className='popover-title'; popTitle.textContent='ã“ã®ä¸¦ã³ã«ãªã£ã¦ã„ã‚‹ç†ç”±'; pop.appendChild(popTitle);
              const pType = document.createElement('p'); pType.textContent = `ã‚¿ã‚¤ãƒ—ï¼š${typeName}`; pop.appendChild(pType);
              try{
                const reasons = [];
                const ax = axes || {};
                const pairs = [
                  ['support', ax.support, 'å¯„ã‚Šæ·»ã„/ç›¸è«‡ãŒæ¬²ã—ã„å‚¾å‘'],
                  ['change', ax.change, 'å¤‰åŒ–ã‚’å¼·ãæ±‚ã‚ã‚‹å‚¾å‘'],
                  ['control', ax.control, 'ä¸»å°æ¨©ã‚’æŒã¡ãŸã„/å…±åŒæ±ºå®šã®å‚¾å‘'],
                  ['motivation', ax.motivation, 'å¤‰ã‚ã‚ŠãŸã„ç†ç”±ãŒæ˜ç¢ºãªå‚¾å‘']
                ];
                pairs.sort((a,b)=> (Number(b[1])||0) - (Number(a[1])||0)).slice(0,2).forEach(([,val,desc])=>{ if(Number(val)>0){ reasons.push(desc); } });
                const pAx = document.createElement('p'); pAx.textContent = reasons.length? `é‡è¦–ã—ãŸè»¸ï¼š${reasons.join('ã€')}` : 'é‡è¦–ã—ãŸè»¸ï¼šå›ç­”ã«åŸºã¥ãç·åˆè©•ä¾¡'; pop.appendChild(pAx);
              }catch{}
              const pLead = document.createElement('p'); pLead.textContent = 'ä¸Šã»ã©ä»Šã®ã‚ãªãŸã«å–ã‚Šçµ„ã¿ã‚„ã™ã„é¸æŠè‚¢ã§ã™ã€‚å¿…è¦ã«å¿œã˜ã¦ä¸¦ã³ã¯èª¿æ•´ã•ã‚Œã¾ã™ã€‚'; pop.appendChild(pLead);
              slider.appendChild(pop);
              // ãƒãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼é–‹é–‰
              btnInfo.addEventListener('click', ()=>{ pop.classList.toggle('show'); });
              document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ pop.classList.remove('show'); } });
              document.addEventListener('click', (e)=>{ if(!pop.contains(e.target) && e.target!==btnInfo){ pop.classList.remove('show'); } });
              article.appendChild(slider);

              function onArrow(dir){ try{ const delta = dir==='next' ? Math.floor(track.clientWidth*0.8) : -Math.floor(track.clientWidth*0.8); track.scrollBy({ left: delta, behavior:'smooth' }); }catch{} }
              btnPrev.addEventListener('click', ()=> onArrow('prev'));
              btnNext.addEventListener('click', ()=> onArrow('next'));
            })();

            // â‘¦ æ€¥ãŒãªãã¦ã„ã„ç†ç”±ï¼ˆæˆé•·å‰æï¼‰
            const gentle = document.createElement('p'); gentle.className='muted'; gentle.style.marginTop='8px'; gentle.textContent = 'ã“ã‚Œã¯ã€Œä»Šã®ã‚ãªãŸã€ã®é¡ã§ã™ã€‚è¡Œå‹•ã‚„çµŒé¨“ã§å¤‰ã‚ã£ã¦ã„ãã¾ã™ã€‚å¾Œã§æˆ»ã£ã¦ãã¦ã‚‚å¤§ä¸ˆå¤«ã€‚';
            article.appendChild(gentle);

            // â‘£ FinemeãŒç´„æŸã™ã‚‹ã“ã¨
            const promh = document.createElement('h3'); promh.textContent='Finemeã¯ã€ã‚ãªãŸã‚’ã“ã†æ‰±ã„ã¾ã™'; article.appendChild(promh);
            const ul = document.createElement('ul');
            ['ç„¡ç†ã«æµè¡Œã‚’æŠ¼ã—ã¤ã‘ã¾ã›ã‚“','ä¾¡æ ¼ã‚ˆã‚Šâ€œç›¸æ€§â€ã‚’å„ªå…ˆã—ã¾ã™','ã‚ãªãŸã®ãƒšãƒ¼ã‚¹ã‚’å°Šé‡ã—ã¾ã™'].forEach(t=>{ const li = document.createElement('li'); li.textContent = t; ul.appendChild(li); });
            article.appendChild(ul);

            // â‘¤ ä¸¦ã³é †ã®è¦‹æ–¹ï¼ˆç›¸æ€§é †ã®æ„å‘³ã¥ã‘ï¼‰
            const readh = document.createElement('h3'); readh.textContent='ä¸¦ã³é †ã®è¦‹æ–¹'; article.appendChild(readh);
            const readp = document.createElement('p'); readp.textContent = 'ä¸Šã®åº—èˆ—ã»ã©ã€ã‚ãªãŸã®ã€Œé¸ã³æ–¹ã€ã«è¿‘ã„å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚ä¾¡æ ¼ã§ã¯ãªãã€Œç´å¾—ã®ã—ã‚„ã™ã•ã€ã€Œå¯„ã‚Šæ·»ã„ã€ã€Œæœ€çŸ­ã§é€²ã‚ã‚‹åŠ›ã€ã€Œä¸–ç•Œè¦³ã®åˆè‡´ã€ã¨ã„ã£ãŸè»¸ã‚’å„ªå…ˆã—ã¦ã„ã¾ã™ã€‚'; article.appendChild(readp);

            // â‘¥ æ¬¡ã®ä¸€æ­©
            const actions = document.createElement('div'); actions.className = 'result-actions';
            const seeBtn = document.createElement('a');
            const typeQuery = (entry?.name) ? `?diag=1&keyword=${encodeURIComponent(entry.name)}` : '?diag=1';
            seeBtn.href = `../pages/search.html${typeQuery}`; seeBtn.className = 'btn'; seeBtn.textContent = 'ã“ã®ã‚¿ã‚¤ãƒ—ã«åˆã†äººã‚’è¦‹ã¦ã¿ã‚‹';
            try{ seeBtn.style.setProperty('color','#fff','important'); }catch{}
            const retryLink = document.createElement('a'); retryLink.href = './index.html'; retryLink.className = 'btn'; retryLink.textContent = 'è¨ºæ–­ã‚’ã‚„ã‚Šç›´ã™';
            const saveBtn = document.createElement('button'); saveBtn.className = 'btn btn-ghost'; saveBtn.textContent = 'çµæœã‚’ã‚³ãƒ”ãƒ¼';
            saveBtn.addEventListener('click', ()=>{
              const text = `${entry.name}\n${entry.catch||''}\n\n${entry.advice||''}`; try{ navigator.clipboard.writeText(text); showToast('çµæœã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'); }catch(e){ showToast('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ'); }
            });
            // æœ€ä¸‹éƒ¨ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¾¤ã«æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ä¿å­˜å°ç·šã‚’çµ±åˆ
            try{
              const BASE_PREFIX = (location.hostname && /github\.io$/i.test(location.hostname)) ? '/fineme' : '';
              const sessionRaw = sessionStorage.getItem('glowup:userSession');
              const isLoggedIn = !!(sessionRaw);
              if(!isLoggedIn){
                const loginBtnBottom = document.createElement('a');
                const nextUrl3 = BASE_PREFIX + '/pages/mypage/diagnosis.html';
                loginBtnBottom.href = BASE_PREFIX + '/pages/user/login.html?next=' + encodeURIComponent(nextUrl3);
                loginBtnBottom.className = 'btn btn-ghost';
                try{ loginBtnBottom.style.setProperty('color','#fff','important'); }catch{}
                loginBtnBottom.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦çµæœã‚’ä¿å­˜ã™ã‚‹';
                actions.appendChild(loginBtnBottom);
              }
            }catch{}
            actions.appendChild(seeBtn); actions.appendChild(retryLink); actions.appendChild(saveBtn); article.appendChild(actions);

            root.appendChild(article);

              // Optional: providerIdãŒã‚¯ã‚¨ãƒªã«ã‚ã‚‹å ´åˆã€åº—èˆ—ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«Ã—è¨ºæ–­ã§ç›¸æ€§èª¬æ˜æ–‡ã‚’ç”Ÿæˆã—ã¦è¡¨ç¤º
              try{
                const u = new URL(location.href);
                const providerId = u.searchParams.get('providerId') || '';
                if(providerId){
                  (async function(){
                    async function loadProviders(){
                      try{ const raw = localStorage.getItem('glowup:providers'); const arr = raw? JSON.parse(raw):[]; return Array.isArray(arr)? arr:[]; }catch{ return []; }
                    }
                    async function loadStaticProviders(){
                      try{ const r = await fetch('../scripts/data/providers.json', { cache:'no-store' }); if(!r.ok) throw new Error(String(r.status)); const j = await r.json(); return Array.isArray(j)? j:[]; }catch(e){ return []; }
                    }
                    const mod = await import('../scripts/compatibility.js');
                    let providers = await loadProviders();
                    if(!providers.length){ providers = await loadStaticProviders(); }
                    const provider = providers.find(p=> p.id === providerId);
                    if(provider){
                      const comp = await mod.generateCompatibility(obj, provider);
                      if(comp){
                        const host = document.createElement('div'); host.className = 'diag-card'; host.style.marginTop = '14px';
                        const head = document.createElement('div'); head.className='stack';
                        const strong = document.createElement('strong'); strong.textContent = 'ã‚ãªãŸã¨ã®ç›¸æ€§èª¬æ˜ï¼ˆåº—èˆ—åˆ¥ï¼‰'; head.appendChild(strong);
                        host.appendChild(head);
                        mod.renderCompatibilityCard(host, comp);
                        root.appendChild(host);
                      }
                    }
                  })();
                }
              }catch(e){ /* optional */ }

            // toast element
            const toast = document.createElement('div'); toast.className = 'toast'; toast.id = 'result-toast'; toast.textContent = '';
            document.body.appendChild(toast);
            function showToast(msg){ const t = document.getElementById('result-toast'); t.textContent = msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2000); }
          }).catch(e=>{ console.error(e); loading.textContent = 'ã‚¿ã‚¤ãƒ—ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'; });
        }catch(e){ console.error(e); renderNotFound(); }
      }

  retryBtn.addEventListener('click', ()=>{ window.location.href = './index.html'; });
    })();
  </script>
</body>
</html>
