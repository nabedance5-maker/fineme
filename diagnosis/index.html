<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Fineme - å°è±¡ã‚¢ãƒƒãƒ—è¨ºæ–­</title>
  <link rel="stylesheet" href="../assets/styles/style.css">
  <link rel="stylesheet" href="../assets/styles/components.css">
  <style>
  .diag-container{max-width:900px;margin:36px auto;padding:20px}
  .diag-card{background:#fff;padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.06)}
  .diag-q{font-weight:800;margin-bottom:12px;font-size:20px}
  .muted{color:#6b7280}
  .tip{font-size:12px;color:#6b7280}
  /* cards */
  .card-grid{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:680px){.card-grid{grid-template-columns:1fr 1fr}}
  .option-card{display:flex;flex-direction:column;gap:6px;border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff;cursor:pointer;transition:box-shadow .2s, transform .05s}
  .option-card:hover{box-shadow:0 10px 24px rgba(2,6,23,0.06)}
  .option-card[aria-checked="true"]{outline:2px solid #2563eb; box-shadow:0 10px 28px rgba(37,99,235,.16)}
  .option-title{font-weight:700}
  .option-desc{font-size:13px;color:#4b5563}
  .radio{display:none}
  /* vertical list for Q3 */
  .vlist{display:flex;flex-direction:column;gap:10px}
  /* intro badge row */
  .assure{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:8px}
  .assure span{display:inline-flex;align-items:center;gap:6px;font-size:12px;background:#fff;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;color:#374151}
  </style>
</head>
<body>
  <header id="site-header"></header>
  <main>
    <div class="diag-container">
      <div class="diag-card">
        <h1>å°è±¡ã‚¢ãƒƒãƒ—è¨ºæ–­</h1>
        <div id="chat-root">
          <div id="progress" style="height:10px;background:#eef2ff;border-radius:6px;margin-bottom:12px;overflow:hidden"><div id="progress-bar" style="height:100%;background:linear-gradient(90deg,#6d28d9,#2563eb);width:0%"></div></div>
          <div id="step-meta" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><div id="step-label">æº–å‚™</div><div id="step-count" class="muted">0 / 3</div></div>
          <div id="question" class="diag-q">ã“ã‚Œã¯ã€ã‚ãªãŸã‚’è©•ä¾¡ã™ã‚‹è¨ºæ–­ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
          <div id="controls" class="stack" style="gap:10px">
            <!-- dynamic controls will be rendered here -->
          </div>
          <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
            <button id="prevBtn" class="btn btn-ghost" disabled>æˆ»ã‚‹</button>
            <button id="nextBtn" class="btn">æ¬¡ã¸</button>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer id="site-footer"></footer>
  <script src="../scripts/main.js" type="module"></script>
  <script>
    // æ–°ãƒ•ãƒ­ãƒ¼ï¼šå°å…¥ â†’ Q1ï¼ˆå‹•æ©Ÿï¼‰ â†’ Q2ï¼ˆã‚¿ã‚¤ãƒ—ï¼‰ â†’ Q3ï¼ˆé–¢ã‚ã‚Šæ–¹ï¼‰
    const STORAGE_KEY = 'fineme:diagnosis:latest';

    const Q1 = [
      { id:'r01', title:'è‡ªä¿¡ã‚’æŒã¡ãŸã„', desc:'äººã¨è©±ã™ã¨ãã€æ‹æ„›ã€ä»•äº‹ã§ã€Œå ‚ã€…ã¨ã—ã¦ã„ãŸã„ã€' },
      { id:'r02', title:'å‘¨ã‚Šã‹ã‚‰ã®è¦‹ã‚‰ã‚Œæ–¹ã‚’å¤‰ãˆãŸã„', desc:'ãªã‚ã‚‰ã‚ŒãŸããªã„ï¼ã¡ã‚ƒã‚“ã¨ã—ã¦è¦‹ã‚‰ã‚ŒãŸã„' },
      { id:'r03', title:'ä»Šã®è‡ªåˆ†ã‚’å°‘ã—å¥½ãã«ãªã‚ŠãŸã„', desc:'è‡ªå·±è‚¯å®šæ„Ÿã‚’ä¸Šã’ãŸã„ï¼æ°—åˆ†ã‚’å¤‰ãˆãŸã„' },
      { id:'r04', title:'ä½•ã‹ã‚’å¤‰ãˆãŸã„ã‘ã©ã€ä½•ã‚’ã™ã‚Œã°ã„ã„ã‹åˆ†ã‹ã‚‰ãªã„', desc:'ã¨ã«ã‹ãä»Šã®ã¾ã¾ã¯å«Œ' },
      { id:'r05', title:'ç‰¹åˆ¥ãªãã£ã‹ã‘ãŒã‚ã£ãŸ', desc:'æ‹æ„›ãƒ»ä»•äº‹ãƒ»ç’°å¢ƒã®å¤‰åŒ–ãªã©' }
    ];

    const Q2 = [
      { id:'w01', name:'æ¸…æ½”æ„Ÿã‚¿ã‚¤ãƒ—', title:'ã¡ã‚ƒã‚“ã¨ã—ã¦è¦‹ã‚‰ã‚ŒãŸã„', desc:'ã ã‚‰ã—ãªã„ãƒ»ç–²ã‚Œã¦è¦‹ãˆã‚‹å°è±¡ã‚’ãªãã—ãŸã„' },
      { id:'w02', name:'è‡ªç„¶ä½“ã‚¿ã‚¤ãƒ—', title:'ç„¡ç†ã—ã¦ãªã„æ„Ÿã˜ã§å¥½å°è±¡ã«ãªã‚ŠãŸã„', desc:'ä½œã‚Šè¾¼ã¿ã™ããšã€é›°å›²æ°—ã‚’ã‚ˆãã—ãŸã„' },
      { id:'w03', name:'å¤§äººè½ã¡ç€ãã‚¿ã‚¤ãƒ—', title:'ä½™è£•ãŒã‚ã£ã¦ä¿¡é ¼ã•ã‚Œã‚‹å°è±¡ã«ãªã‚ŠãŸã„', desc:'å¹´ç›¸å¿œãƒ»è½ã¡ç€ã„ãŸé­…åŠ›ã‚’å‡ºã—ãŸã„' },
      { id:'w04', name:'ç”·ã‚‰ã—ã•ã‚¿ã‚¤ãƒ—', title:'é ¼ã‚‚ã—ã•ã‚’å¼·ã‚ãŸã„', desc:'æ¸…æ½”Ã—ã‚µã‚¤ã‚ºæ„Ÿã§éå‰°ã«èª‡å¼µã—ãªã„' },
      { id:'w05', name:'é¸ã°ã‚Œã‚‹æ‹æ„›ã‚¿ã‚¤ãƒ—', title:'è¿‘è·é›¢ã§å¥½å°è±¡ã«ãªã‚ŠãŸã„', desc:'è¦ªè¿‘æ„ŸÃ—æ¸…æ½”æ„ŸÃ—å°‘ã—ã®è‰²æ°—' },
      { id:'w06', name:'è‡ªä¿¡é†¸æˆã‚¿ã‚¤ãƒ—', title:'ã§ãã‚‹è‡ªåˆ†ã‚’å®Ÿæ„Ÿã—ãŸã„', desc:'è¦‹ãŸç›®ã®ç¿’æ…£åŒ–ã§è‡ªä¿¡ã‚’ç©ã¿ä¸Šã’ã‚‹' },
      { id:'w07', name:'ç¬¬ä¸€å°è±¡å¤‰åŒ–ã‚¿ã‚¤ãƒ—', title:'ã¯ã£ãã‚Šå¤‰ãˆãŸã„', desc:'é«ªãƒ»çœ‰ãƒ»è¼ªéƒ­ãƒ»è‰²ã§åˆ¥äººç´šã«' },
      { id:'w08', name:'ç¯€ç›®å¤‰åŒ–ã‚¿ã‚¤ãƒ—', title:'ç¯€ç›®ã«ãµã•ã‚ã—ãæ•´ãˆãŸã„', desc:'å°±è·ãƒ»è»¢è·ãƒ»çµå©šãªã©ã«åˆã‚ã›ã¦' }
    ];

    const Q3 = [
      { id:'s01', name:'ç†ç”±ã‚„æ ¹æ‹ ã‚’ã—ã£ã‹ã‚ŠçŸ¥ã‚ŠãŸã„ã‚¿ã‚¤ãƒ—', title:'ã€Œãªãœãã†ãªã‚‹ã®ã‹ã€ã‚’ç†è§£ã—ãªãŒã‚‰é€²ã‚ãŸã„', desc:'ç´å¾—ã—ã¦ã‹ã‚‰å¤‰ã‚ã‚ŠãŸã„' },
      { id:'s02', name:'ãƒ—ãƒ­ã«ä»»ã›ãŸã„ã‚¿ã‚¤ãƒ—', title:'ç´°ã‹ã„ã“ã¨ã¯ã„ã„ã‹ã‚‰ã€ä¼¼åˆã†ã‚ˆã†ã«ã—ã¦ã»ã—ã„', desc:'è‡ªåˆ†ã§è€ƒãˆã‚‹ã®ã¯æ­£ç›´è‹¦æ‰‹' },
      { id:'s03', name:'ä¸€ç·’ã«ç›¸è«‡ã—ãªãŒã‚‰æ±ºã‚ãŸã„ã‚¿ã‚¤ãƒ—', title:'è©±ã—ãªãŒã‚‰æ–¹å‘æ€§ã‚’ã™ã‚Šåˆã‚ã›ãŸã„', desc:'è‡ªåˆ†ã®æ„è¦‹ã‚‚å°Šé‡ã—ã¦ã»ã—ã„' }
    ];

    const qEl = document.getElementById('question');
    const ctrl = document.getElementById('controls');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const progressBar = document.getElementById('progress-bar');
    const stepLabel = document.getElementById('step-label');
    const stepCount = document.getElementById('step-count');

    // phase: -1=intro, 0=Q1,1=Q2,2=Q3
    let phase = -1;
    const total = 3;
    const answers = { q1:null, q2:null, q3:null };

    function setProgress(){
      const current = Math.max(0, phase+1); // intro -> 0
      const pct = Math.round((current / total) * 100);
      progressBar.style.width = pct + '%';
      stepCount.textContent = (current) + ' / ' + total;
    }

    function renderIntro(){
      stepLabel.textContent = 'æº–å‚™';
      qEl.textContent = 'ã“ã‚Œã¯ã€ã‚ãªãŸã‚’è©•ä¾¡ã™ã‚‹è¨ºæ–­ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
      ctrl.innerHTML = '';
      const p1 = document.createElement('p'); p1.textContent = 'ä»Šã®ã‚ãªãŸãŒã€Œã©ã‚“ãªäººã‹ã€ã‚’æ±ºã‚ã‚‹ãŸã‚ã§ã¯ãªãã€ã“ã‚Œã‹ã‚‰ã€Œã©ã†å¤‰ã‚ã£ã¦ã„ã‘ãã†ã‹ã€ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®è¨ºæ–­ã§ã™ã€‚'; ctrl.appendChild(p1);
      const p2 = document.createElement('p'); p2.textContent = 'æ­£è§£ã‚‚ã€ä¸æ­£è§£ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šã®æ°—æŒã¡ã«ä¸€ç•ªè¿‘ã„ã‚‚ã®ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚'; ctrl.appendChild(p2);
      const assure = document.createElement('div'); assure.className='assure';
      assure.innerHTML = '<span>â±ï¸ ç´„3åˆ†</span><span>ğŸ•¶ï¸ ç™»éŒ²ãƒ»èª²é‡‘ãªã—</span><span>ğŸ—‚ï¸ çµæœã¯ã„ã¤ã§ã‚‚è¦‹è¿”ã›ã¾ã™</span>';
      ctrl.appendChild(assure);
      prevBtn.disabled = true;
      nextBtn.textContent = 'è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹';
      nextBtn.disabled = false;
      setProgress();
    }

    function renderQ1(){
      stepLabel.textContent = 'Q1ï½œå‹•æ©Ÿï¼ˆWHYï¼‰';
      qEl.textContent = 'ã‚ãªãŸãŒã€Œå¤–è¦‹ã‚’å¤‰ãˆãŸã„ã€ã¨æ€ã£ãŸä¸€ç•ªã®ç†ç”±ã¯ã€ä»Šã©ã‚Œã«ä¸€ç•ªè¿‘ã„ã§ã™ã‹ï¼Ÿ';
      ctrl.innerHTML = '';
      const tip = document.createElement('div'); tip.className='tip'; tip.textContent = 'è¿·ã£ãŸã‚‰ã€ä»Šã®æ°—æŒã¡ã«ä¸€ç•ªè¿‘ã„ã‚‚ã®ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚'; ctrl.appendChild(tip);
      const grid = document.createElement('div'); grid.className='card-grid';
      Q1.forEach((opt, idx)=>{
        const card = document.createElement('button'); card.type='button'; card.className='option-card'; card.setAttribute('aria-checked', answers.q1===opt.id?'true':'false');
        const h = document.createElement('div'); h.className='option-title'; h.textContent = opt.title; card.appendChild(h);
        const d = document.createElement('div'); d.className='option-desc'; d.textContent = opt.desc; card.appendChild(d);
        card.addEventListener('click', ()=>{ answers.q1 = opt.id; [...grid.children].forEach(c=>c.setAttribute('aria-checked','false')); card.setAttribute('aria-checked','true'); nextBtn.disabled = false; });
        grid.appendChild(card);
      });
      ctrl.appendChild(grid);
      // Q1ã§ã¯å‰ã®å°å…¥ç”»é¢ï¼ˆphase=-1ï¼‰ã¸æˆ»ã‚Œã‚‹ã‚ˆã†ã«ã€
      // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã¯å°å…¥æ™‚ã®ã¿ç„¡åŠ¹åŒ–ã—ã€Q1ã§ã¯æœ‰åŠ¹åŒ–ã™ã‚‹
      prevBtn.disabled = (phase<=-1);
      nextBtn.textContent = 'æ¬¡ã¸';
      nextBtn.disabled = !answers.q1;
      setProgress();
    }

    function renderQ2(){
      stepLabel.textContent = 'Q2ï½œãªã‚ŠãŸã„å°è±¡ï¼ˆWHATï¼‰';
      qEl.textContent = 'ã‚‚ã—ã€Œç¬¬ä¸€å°è±¡ã€ã‚’ä¸€ã¤ã ã‘ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ãã‚‹ã¨ã—ãŸã‚‰ã€ã‚ãªãŸã¯ã©ã‚Œã‚’ä¸€ç•ªå„ªå…ˆã—ãŸã„ã§ã™ã‹ï¼Ÿ';
      ctrl.innerHTML = '';
      const tip = document.createElement('div'); tip.className='tip'; tip.textContent = 'ã„ã¡ã°ã‚“ã€Œã“ã†è¦‹ã‚‰ã‚ŒãŸã„ã€ã«è¿‘ã„ã‚‚ã®ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚'; ctrl.appendChild(tip);
      const grid = document.createElement('div'); grid.className='card-grid';
      Q2.forEach(opt=>{
        const card = document.createElement('button'); card.type='button'; card.className='option-card'; card.setAttribute('aria-checked', answers.q2===opt.id?'true':'false');
        const h = document.createElement('div'); h.className='option-title'; h.textContent = opt.name; card.appendChild(h);
        const t = document.createElement('div'); t.style.fontSize='13px'; t.style.color='#111827'; t.textContent = 'â€” ' + opt.title; card.appendChild(t);
        const d = document.createElement('div'); d.className='option-desc'; d.textContent = opt.desc; card.appendChild(d);
        card.addEventListener('click', ()=>{ answers.q2 = opt.id; [...grid.children].forEach(c=>c.setAttribute('aria-checked','false')); card.setAttribute('aria-checked','true'); nextBtn.disabled = false; });
        grid.appendChild(card);
      });
      ctrl.appendChild(grid);
      prevBtn.disabled = false;
      nextBtn.textContent = 'æ¬¡ã¸';
      nextBtn.disabled = !answers.q2;
      setProgress();
    }

    function renderQ3(){
      stepLabel.textContent = 'Q3ï½œé–¢ã‚ã‚Šæ–¹ï¼ˆHOWï¼‰';
      qEl.textContent = 'è¦‹ãŸç›®ã‚’å¤‰ãˆã‚‹ã¨ãã€ã‚ãªãŸã¯ã©ã‚“ãªé–¢ã‚ã‚Šæ–¹ã‚’æ±‚ã‚ã¾ã™ã‹ï¼Ÿ';
      ctrl.innerHTML = '';
      const tip = document.createElement('div'); tip.className='tip'; tip.textContent = 'æ­£è§£ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸€ç•ªã—ã£ãã‚Šãã‚‹ã‚‚ã®ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚'; ctrl.appendChild(tip);
      const vlist = document.createElement('div'); vlist.className='vlist';
      Q3.forEach(opt=>{
        const card = document.createElement('button'); card.type='button'; card.className='option-card'; card.style.textAlign='left'; card.setAttribute('aria-checked', answers.q3===opt.id?'true':'false');
        const h = document.createElement('div'); h.className='option-title'; h.textContent = opt.name; card.appendChild(h);
        const t = document.createElement('div'); t.style.fontSize='13px'; t.style.color='#111827'; t.textContent = opt.title; card.appendChild(t);
        const d = document.createElement('div'); d.className='option-desc'; d.textContent = opt.desc; card.appendChild(d);
        card.addEventListener('click', ()=>{ answers.q3 = opt.id; [...vlist.children].forEach(c=>c.setAttribute('aria-checked','false')); card.setAttribute('aria-checked','true'); nextBtn.disabled = false; });
        vlist.appendChild(card);
      });
      ctrl.appendChild(vlist);
      prevBtn.disabled = false;
      nextBtn.textContent = 'ææ¡ˆã‚’è¦‹ã‚‹';
      nextBtn.disabled = !answers.q3;
      setProgress();
    }

    function render(){
      if(phase === -1) return renderIntro();
      if(phase === 0) return renderQ1();
      if(phase === 1) return renderQ2();
      return renderQ3();
    }

    prevBtn.addEventListener('click', ()=>{
      if(phase <= -1) return;
      phase -= 1;
      render();
    });

    nextBtn.addEventListener('click', ()=>{
      if(phase < 2){ phase += 1; render(); return; }
      // ä¿å­˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆäº’æ›æ€§ç¶­æŒï¼‰ï¼šintent(type_id/name) + why/how ã®ãƒ©ãƒ™ãƒ«
      const type = Q2.find(x=> x.id === answers.q2) || Q2[0];
      const style = Q3.find(x=> x.id === answers.q3) || Q3[0];
      const out = {
        at: Date.now(), version:'v3',
        intent: { type_id: type.id, type_name: type.name },
        why: { reason_id: answers.q1 },
        how: { style_id: style.id, style_name: style.name }
      };
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(out)); }catch(e){ /* ignore */ }
  window.location.href = 'step1.html';
    });

    // åˆæœŸæç”»
    render();
  </script>
</body>
</html>
