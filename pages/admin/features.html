<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>特集作成・編集 | Fineme</title>
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="../../assets/styles/style.css" />
  <link rel="stylesheet" href="../../assets/styles/components.css" />
  <style>
    /* Force sticky toolbar within modal content (override global top offset) */
    #feature-modal .modal-content .rte-toolbar{position:sticky !important; top:0 !important; z-index:10; background:#fff}
    /* Scroll lock when modal open */
    body.modal-open{ overflow:hidden; }
    .admin-grid{display:grid;grid-template-columns:240px 1fr;gap:24px;align-items:start}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);display:block;z-index:999}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:24px;z-index:1000}
    .modal[hidden], .modal-backdrop[hidden]{display:none}
    #feature-modal-backdrop{opacity:0;transition:opacity .2s ease}
    #feature-modal-backdrop.is-open{opacity:1}
  #feature-modal .modal-content{position:relative;opacity:0;transform:translateY(8px) scale(.98);transition:opacity .2s ease, transform .2s ease;width:min(100%,960px);max-height:min(90vh,820px);overflow:auto}
    #feature-modal.is-open .modal-content{opacity:1;transform:none}
  .rte-toolbar{position:sticky; top:0; z-index:2; background:#fff; border-bottom:1px solid var(--color-border)}
    /* Optional: ensure editor area has enough height for comfortable editing */
    .rte-editor{min-height:320px}
  </style>
</head>
<body>
  <header id="site-header"></header>
  <main class="section">
    <div class="container admin-grid">
      <aside id="admin-sidebar"></aside>
      <section class="stack">
        <h1 class="section-title">特集管理</h1>
        <section id="features-list-section" class="stack">
          <div class="space-between" style="display:flex; align-items:center">
            <h2 class="section-title" style="font-size:22px; margin:0">特集一覧</h2>
            <div class="cluster">
              <button type="button" id="features-export" class="btn btn-ghost">エクスポート</button>
              <label for="features-import-input" class="btn btn-ghost" style="margin:0">インポート</label>
              <input id="features-import-input" type="file" accept="application/json" style="display:none" />
              <button type="button" id="features-seed" class="btn btn-ghost">サンプル読み込み</button>
              <button type="button" id="features-restore" class="btn btn-ghost">復元（推奨セット）</button>
              <button type="button" id="features-create" class="btn" onclick="window.__featureCreate && window.__featureCreate()">新規特集を作成</button>
              <label class="cluster" style="align-items:center; gap:8px; margin-left:8px">
                <input id="features-auto-export" type="checkbox" />
                <span class="muted">保存時に自動バックアップ（ダウンロード）</span>
              </label>
            </div>
          </div>
          <div class="card" style="overflow:auto">
            <table style="width:100%; border-collapse:collapse">
              <thead>
                <tr>
                  <th style="text-align:left; padding:12px; border-bottom:1px solid var(--color-border)">タイトル</th>
                  <th style="text-align:left; padding:12px; border-bottom:1px solid var(--color-border)">ステータス</th>
                  <th style="text-align:left; padding:12px; border-bottom:1px solid var(--color-border)">更新日</th>
                  <th style="text-align:left; padding:12px; border-bottom:1px solid var(--color-border)">操作</th>
                </tr>
              </thead>
              <tbody id="features-table-body"></tbody>
            </table>
          </div>
        </section>

        <section id="feature-editor-section" class="stack" hidden>
          <!-- Modal Backdrop and Container -->
          <div id="feature-modal-backdrop" class="modal-backdrop" hidden></div>
          <div id="feature-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="feature-modal-title" hidden>
            <div class="modal-content card" style="padding:20px">
              <div class="cluster" style="justify-content:space-between;align-items:center;margin-bottom:8px">
                <h2 id="feature-modal-title" style="margin:0">特集編集</h2>
                <button id="feature-modal-close" class="btn btn-ghost" type="button" aria-label="閉じる" onclick="window.__featureBack && window.__featureBack()">×</button>
              </div>
          <form id="feature-form" class="stack" style="padding:4px;max-width:unset">
            <input type="hidden" id="feature-id" name="id" />
            <div class="stack">
              <label>タイトル<input id="feature-title" name="title" type="text" placeholder="タイトルを入力" required /></label>
              <label>概要<textarea id="feature-summary" name="summary" rows="3" placeholder="概要（リード文）"></textarea></label>
              <label>サムネイル画像URL<input id="feature-thumbnail" name="thumbnail" type="url" placeholder="https://example.com/cover.jpg または data:image/..." /></label>
              <div class="cluster" style="align-items:center">
                <label class="btn btn-ghost" for="feature-thumbnail-file" style="margin:0">端末から選択</label>
                <input id="feature-thumbnail-file" type="file" accept="image/*" style="display:none" />
                <span class="muted">URLまたは端末画像のどちらかを指定できます（端末画像はブラウザ内に保存）。</span>
              </div>
              <div id="feature-thumb-preview" class="card" style="max-width:520px; overflow:hidden">
                <img id="feature-thumbnail-preview" alt="サムネイルプレビュー" style="display:none; aspect-ratio:4/3; width:100%; object-fit:cover" />
              </div>
              <label for="feature-body-editor">本文</label>
                <div class="rte" style="position:relative">
                  <div class="rte-toolbar" role="toolbar" aria-label="テキスト編集">
                    <select id="rte-heading" title="見出し">
                      <option value="p">段落</option>
                      <option value="h2">見出し H2</option>
                      <option value="h3">見出し H3</option>
                      <option value="h4">見出し H4</option>
                    </select>
                    <button type="button" class="rte-btn" data-cmd="bold" title="太字"><strong>B</strong></button>
                    <button type="button" class="rte-btn" data-cmd="italic" title="斜体"><em>I</em></button>
                    <button type="button" class="rte-btn" data-cmd="underline" title="下線"><span style="text-decoration:underline">U</span></button>
                    <span class="rte-sep"></span>
                    <button type="button" class="rte-btn" data-cmd="insertUnorderedList" title="箇条書き">• List</button>
                    <button type="button" class="rte-btn" data-cmd="insertOrderedList" title="番号付き">1. List</button>
                    <button type="button" class="rte-btn" data-cmd="formatBlock" data-value="blockquote" title="引用">“”</button>
                    <span class="rte-sep"></span>
                    <button type="button" class="rte-btn" id="rte-link" title="リンク">Link</button>
                    <button type="button" class="rte-btn" id="rte-image" title="画像">Img</button>
                    <button type="button" class="rte-btn" id="rte-image-file" title="端末から画像">Img(端末)</button>
                    <input id="rte-image-file-input" type="file" accept="image/*" style="display:none" />
                    <span class="rte-sep"></span>
                    <button type="button" class="rte-btn" id="rte-align-left" title="左揃え">⟸</button>
                    <button type="button" class="rte-btn" id="rte-align-center" title="中央揃え">⇔</button>
                    <button type="button" class="rte-btn" id="rte-align-right" title="右揃え">⟹</button>
                    <span class="rte-sep"></span>
                    <label class="muted" style="display:inline-flex;align-items:center;gap:6px">
                      <span>画像サイズ</span>
                      <select id="rte-image-size" title="画像サイズ">
                        <option value="">auto</option>
                        <option value="sm">小</option>
                        <option value="md">中</option>
                        <option value="lg">大</option>
                        <option value="full">全幅</option>
                      </select>
                    </label>
                    <span class="rte-sep"></span>
                    <button type="button" class="rte-btn" data-cmd="removeFormat" title="書式クリア">Clear</button>
                  </div>
                  <div id="feature-body-editor" class="rte-editor" contenteditable="true" aria-label="本文エディタ" style="padding-top:8px"></div>
                  <textarea id="feature-body" name="body" hidden></textarea>
                </div>
              <div class="cluster" style="align-items:center; gap:12px">
                <label>ステータス
                  <select id="feature-status" name="status">
                    <option value="draft">下書き</option>
                    <option value="published">公開</option>
                    <option value="private">非公開</option>
                  </select>
                </label>
                <span id="feature-message" class="muted"></span>
                <div class="space-between" style="margin-left:auto; display:flex; gap:8px">
                  <button type="button" id="feature-new" class="btn btn-ghost">新規</button>
                  <button type="button" id="feature-save-draft" class="btn btn-ghost">下書き保存</button>
                  <button type="submit" id="feature-save" class="btn">保存</button>
                </div>
              </div>
            </div>
          </form>
            </div>
          </div>
        </section>
      </section>
    </div>
  </main>
  <footer id="site-footer"></footer>
  <script src="../../scripts/main.js" type="module"></script>
  <script src="../../scripts/partials.js" type="module"></script>
  <script src="../../scripts/admin-features.js?v=20251015" type="module"></script>
</body>
</html>
