<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>資料請求・掲載相談 | Fineme</title>
  <link rel="icon" href="../../favicon.ico" />
  <link rel="stylesheet" href="../../assets/styles/style.css" />
  <style>
    .section{ padding:40px 0 }
    .page-title{ font-size:28px; margin-bottom:6px }
    .lead{ color:#6b7280 }
  </style>
</head>
<body>
  <header id="site-header"></header>
  <main class="section">
    <div class="container stack">
      <h1 class="page-title">資料請求・掲載についてのご相談</h1>
      <p class="lead">最短で相談したい方向けの簡易フォームです。2分で完了。</p>

      <form id="provider-inquiry-form" class="stack" style="gap:12px" novalidate>
        <div class="grid-2">
          <div class="stack">
            <label for="bizName">会社名・屋号<span style="color:#b91c1c"> *</span></label>
            <input type="text" id="bizName" name="bizName" required placeholder="例: 株式会社〇〇 / サロン△△" />
          </div>
          <div class="stack">
            <label for="contactName">ご担当者名<span style="color:#b91c1c"> *</span></label>
            <input type="text" id="contactName" name="contactName" required placeholder="例: 山田 太郎" />
          </div>
        </div>
        <div class="grid-2">
          <div class="stack">
            <label for="email">メールアドレス<span style="color:#b91c1c"> *</span></label>
            <input type="email" id="email" name="email" required placeholder="例: you@example.com" />
          </div>
          <div class="stack">
            <label for="phone">電話番号（任意）</label>
            <input type="tel" id="phone" name="phone" placeholder="例: 090-1234-5678" />
          </div>
        </div>
        <div class="grid-2">
          <div class="stack">
            <label for="category">掲載カテゴリ（目安）</label>
            <select id="category" name="category">
              <option value="">未選択</option>
              <option value="hair">美容室・ヘアサロン</option>
              <option value="esthetic">エステ・痩身</option>
              <option value="nails">ネイル</option>
              <option value="makeup">メイク・顔分析</option>
              <option value="eyelash">まつ毛・アイブロウ</option>
              <option value="cosmetic">美容外科・美容クリニック</option>
            </select>
          </div>
          <div class="stack">
            <label for="contactPref">希望連絡方法</label>
            <select id="contactPref" name="contactPref">
              <option value="email">メールでの返信希望</option>
              <option value="phone">電話での連絡希望</option>
              <option value="either">どちらでも</option>
            </select>
          </div>
        </div>
        <div class="stack">
          <label for="message">ご相談内容（自由記入）</label>
          <textarea id="message" name="message" rows="5" placeholder="例: 掲載プランの詳細を知りたい / 資料を送付してほしい など"></textarea>
        </div>
        <div class="cluster" style="align-items:center; gap:8px">
          <input type="checkbox" id="consent" required />
          <label for="consent" class="muted">プライバシーポリシーに同意します（個人情報は問い合わせ対応の目的でのみ使用）</label>
        </div>
        <div class="cta">
          <button type="submit" class="btn btn-primary">問い合わせを送信</button>
          <button type="button" id="copyInquiry" class="btn btn-ghost">内容をコピー</button>
        </div>
        <p class="muted" id="inquiryStatus" aria-live="polite"></p>
      </form>

      <div class="cluster" style="margin-top:12px">
        <a class="btn btn-ghost" href="./join.html">掲載者募集LPに戻る</a>
      </div>
    </div>
  </main>
  <footer id="site-footer"></footer>
  <script src="../../scripts/main.js" type="module"></script>
  <script src="../../scripts/partials.js" type="module"></script>
  <script type="module">
    try{
      const { recordEvent } = await import('../../scripts/metrics.js');
      recordEvent('inquiry_view', { page: 'provider_inquiry' });
    }catch{}
  </script>
  <script type="module">
    try{
      const form = document.getElementById('provider-inquiry-form');
      const statusEl = document.getElementById('inquiryStatus');
      const copyBtn = document.getElementById('copyInquiry');
      const saveInquiry = (data)=>{
        const k = 'fineme:provider:inquiries';
        const arr = JSON.parse(localStorage.getItem(k)||'[]');
        arr.push({ ...data, createdAt: new Date().toISOString() });
        localStorage.setItem(k, JSON.stringify(arr));
      };
      function mapCategoryLabel(v){
        const map = {
          hair: '美容室・ヘアサロン', esthetic: 'エステ・痩身', nails: 'ネイル',
          makeup: 'メイク・顔分析', eyelash: 'まつ毛・アイブロウ', cosmetic: '美容外科・美容クリニック'
        };
        return map[v] || '未選択';
      }
      function summarize(data){
        return [
          `【会社/屋号】${data.bizName}`,
          `【担当者】${data.contactName}`,
          `【メール】${data.email}`,
          data.phone ? `【電話】${data.phone}` : '',
          data.category ? `【カテゴリ】${mapCategoryLabel(data.category)}` : '',
          `【連絡希望】${data.contactPref}`,
          `【内容】${(data.message||'').trim()}`
        ].filter(Boolean).join('\n');
      }
      if(form){
        form.addEventListener('submit', async (e)=>{
          e.preventDefault();
          const fd = new FormData(form);
          const data = {
            bizName: fd.get('bizName')?.toString().trim(),
            contactName: fd.get('contactName')?.toString().trim(),
            email: fd.get('email')?.toString().trim(),
            phone: fd.get('phone')?.toString().trim(),
            category: fd.get('category')?.toString(),
            contactPref: fd.get('contactPref')?.toString(),
            message: fd.get('message')?.toString()
          };
          const consent = document.getElementById('consent')?.checked;
          if(!data.bizName || !data.contactName || !data.email || !consent){
            statusEl.textContent = '必須項目が未入力です（会社名・担当者・メール・同意）';
            statusEl.style.color = '#b91c1c';
            return;
          }
          try{
            saveInquiry(data);
            statusEl.textContent = '送信を受け付けました。担当よりご連絡します。';
            statusEl.style.color = '#111827';
            try{
              const { recordEvent } = await import('../../scripts/metrics.js');
              recordEvent('lp_inquiry_submit', { page:'provider_inquiry', category: data.category || '' });
            }catch{}
            form.reset();
          }catch(err){
            statusEl.textContent = '保存に失敗しました。再度お試しください。';
            statusEl.style.color = '#b91c1c';
          }
        });
      }
      if(copyBtn && form){
        copyBtn.addEventListener('click', ()=>{
          const fd = new FormData(form);
          const data = {
            bizName: fd.get('bizName')?.toString().trim() || '',
            contactName: fd.get('contactName')?.toString().trim() || '',
            email: fd.get('email')?.toString().trim() || '',
            phone: fd.get('phone')?.toString().trim() || '',
            category: fd.get('category')?.toString() || '',
            contactPref: fd.get('contactPref')?.toString() || '',
            message: fd.get('message')?.toString() || ''
          };
          const text = summarize(data);
          navigator.clipboard.writeText(text).then(()=>{
            statusEl.textContent = '内容をクリップボードにコピーしました。';
            statusEl.style.color = '#111827';
          }).catch(()=>{
            statusEl.textContent = 'コピーに失敗しました。';
            statusEl.style.color = '#b91c1c';
          });
        });
      }
    }catch{}
  </script>
</body>
</html>
