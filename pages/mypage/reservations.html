<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>予約履歴 | Fineme</title>
  <link rel="stylesheet" href="../../assets/styles/style.css" />
  <link rel="stylesheet" href="../../assets/styles/components.css" />
  <style>
    .status-pending{ color:#92400e }
    .status-visited{ color:#065f46 }
  </style>
</head>
<body>
  <header id="site-header"></header>
  <main class="section">
    <div class="container mypage-layout">
      <aside id="mypage-sidenav"></aside>
      <section class="stack">
        <h1 class="section-title">予約履歴</h1>
        <div class="card" style="padding:16px; overflow:auto">
          <table class="table responsive">
            <thead>
              <tr>
                <th>送信日時</th>
                <th>サービス</th>
                <th>日付</th>
                <th>時間</th>
                <th>ステータス</th>
                <th>店舗コメント</th>
                <th>店舗</th>
                <th>メモ</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="user-requests-tbody">
              <tr><td colspan="9"><p class="muted" style="margin:12px 0">読み込み中...</p></td></tr>
            </tbody>
          </table>
          <p id="user-requests-message" class="muted" aria-live="polite" style="margin:12px 0 0"></p>
          <div id="review-editor-host" class="stack" style="margin-top:16px;"></div>
        </div>
      </section>
    </div>
  </main>
  <footer id="site-footer"></footer>
  <script src="../../scripts/main.js" type="module"></script>
  <script type="module">
    import { listReservations } from '../../scripts/points.js';
    const host = document.getElementById('reservations-list');
    if(host){
      const arr = listReservations();
      if(!arr.length){ const p=document.createElement('p'); p.className='muted'; p.textContent='予約履歴がありません。'; host.appendChild(p); }
      arr.forEach(r=>{
        const li = document.createElement('li');
        const st = (r.status==='visited')? '来店確認済み（ポイント付与完了）' : '来店確認中（店舗が確認するとポイントが付与されます）';
        li.innerHTML = `<strong>${r.title}</strong> - ${new Date(r.visitDate).toLocaleString('ja-JP')} - <span class="${r.status==='visited'?'status-visited':'status-pending'}">${st}</span>`;
        host.appendChild(li);
      });
    }
  </script>
  <script src="../../scripts/partials.js" type="module"></script>
  <script src="../../scripts/mypage-reservations.js" type="module"></script>
  <script type="module">
    import { requireUserAuth } from '../../scripts/user-auth.js';
    requireUserAuth();
  </script>
</body>
</html>
